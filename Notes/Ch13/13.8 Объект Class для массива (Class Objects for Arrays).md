2025-11-04 13:07
Tags: #


- Получение `Class`, internal name (`[I`, `[[Ljava.lang.String;`), `instanceof`, reflection-access.
    
- Примеры ×3 / ошибки ×2 / подводные камни.

### Формальное определение

- «If the component type of a reference-type array is `C`, then the class of the array is `C[]`, and is represented by the run-time object `Class<C[]>`. All arrays are instances of a class that is a subtype of `java.lang.Object`. The `Class` objects for arrays are shared across all array types of the same component type and same dimensionality. » ([titanium.cs.berkeley.edu](https://titanium.cs.berkeley.edu/doc/java-langspec-1.0/10.doc.html?utm_source=chatgpt.com "The Java Language Specification Arrays"))
    

### Подтемы

8.1. Как получить `Class`-объект массива  
8.2. Имя класса массива (внутреннее)  
8.3. Совместимость и `instanceof`  
8.4. Ограничения отражения (реализация JVM)

### Развёрнутое пояснение

**8.1 Получение `Class`:**  
Например, `int[].class`, `String[][].class`. Можно также через объект: `arr.getClass()`.  
**8.2 Имя класса массива:**  
Внутреннее имя массива вида `"[I"` (для `int[]`), `"[Ljava.lang.String;"` (для `String[]`), `"[ [I"` (для `int[][]`). Это см. `Class.getName()`.  
**8.3 Совместимость и `instanceof`:**  
Массив `S[]` является `instanceof T[]`, если `S` подтип `T`. Пример: `String[] sa = new String[3]; boolean b = (sa instanceof Object[]); // true`.  
**8.4 Ограничения отражения:**  
Через `java.lang.reflect.Array` можно динамически создавать и обращаться к массивам. ([Oracle Docs](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/reflect/Array.html?utm_source=chatgpt.com "Array (Java SE 11 & JDK 11 ) - Oracle Help Center"))

### Примеры (корректные)

```java
// Пример 1
int[] a = new int[3];
Class<?> c1 = a.getClass();
System.out.println(c1.isArray());     // true
System.out.println(c1.getComponentType() == int.class); // true

// Пример 2
String[][] s = new String[2][];
Class<?> c2 = String[][].class;
System.out.println(c2.getName());     // "[[Ljava.lang.String;"

// Пример 3
Object o = new Integer[5];
System.out.println(o instanceof Number[]); // true
```

### Примеры (ошибочные)

```java
// Ошибка 1
int[] a2 = new int[2];
if(a2 instanceof Integer[]) {         // compile-time error: incompatible types
    …
}

// Ошибка 2
Class<?> c3 = int.class;
Class<?> comp = c3.getComponentType(); // returns null, не массив
```

### Типичные ошибки и подводные камни

- Подводный момент: имя класса массива через `getName()` не интуитивно (начинается с `[`).
    
- Ошибка: думать, что `int[]` и `Integer[]` имеют одинаковый тип – нет.
    
- При отражении забывают, что длину массива можно получить только через `Array.getLength()` или `((T[])o).length`, а не через метод `length()`.
    
