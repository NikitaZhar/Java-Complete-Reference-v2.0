2025-10-27 13:48
Tags: #toFormat

4.1.7 JVM Memory Model — Модель памяти JVM и представление типов

## **4.1.7.1 Назначение модели памяти**

Модель памяти в JVM определяет:

- **где и как** хранятся значения примитивных и ссылочных типов;
    
- **как работает доступ к значениям**;
    
- **какие типы данных могут находиться в стеке и куче**;
    
- **как тип влияет на форму хранения значения**.
    

> Тип данных определяет не только поведение, но и область хранения значения во время выполнения программы.

---

## **4.1.7.2 Основные области памяти JVM**

|Область|Назначение|Какие значения хранятся|
|---|---|---|
|**Stack (стек)**|Временные данные вызовов методов|примитивные значения, ссылки на объекты|
|**Heap (куча)**|Долговременное хранение объектов|объекты классов, массивы, строки, записи (record), enum|

**Примитивы** могут храниться:

- как _отдельные значения_ в стеке;
    
- как _поля объектов_, где объект находится в куче.
    

**Ссылки** всегда хранятся в стеке (или в поле объекта), а **сами объекты — в куче**.

---

## **4.1.7.3 Представление примитивных и ссылочных значений**

| Тип                        | Где хранится значение                                                                                        | Комментарий                                              |
| -------------------------- | ------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------- |
| Примитив (`int`, `double`) | непосредственно в стеке (или внутри объекта в куче)                                                          | значение записывается напрямую                           |
| Ссылка (`String`, массив)  | в стеке (или в поле объекта)                                                                                 | содержит адрес объекта в куче                            |
| Объект                     | в куче                                                                                                       | доступен только через ссылку                             |
| `null`                     | специальное ссылочное значение; хранится там же, где хранится сама переменная или поле (как значение ссылки) | специальное ссылочное значение, не указывающее на объект |

---

## **4.1.7.4 Пример хранения значений**

```java
int x = 10;         // x находится в стеке, значение 10 — примитив
String s = "Java";  // s находится в стеке, значение — ссылка на объект в куче
```

- Примитив `10` хранится непосредственно.
    
- Переменная `s` содержит ссылку, указывающую на строковый объект в куче.
    

---

## **4.1.7.5 Объекты и ссылки**

- Все ссылочные значения **указывают на объекты**, созданные с использованием оператора `new` или полученные через литералы.
    
- Объекты размещаются **только в куче**, независимо от того, где объявлена переменная.
    
- Несколько ссылок могут указывать на один объект.
    

```java
String a = new String("ABC");
String b = a; // обе ссылки указывают на один объект
```

---

## **4.1.7.6 Передача значений в методы**

В Java все аргументы передаются **по значению** (_pass-by-value_).

- Для примитивов передаётся **само значение**.
    
- Для ссылочных типов передаётся **копия ссылки**, а не сам объект.
    

```java
void test(String s) { ... }

String x = "Hi";
test(x); // передаётся копия ссылки на объект String
```

Изменение объекта внутри метода влияет на исходный объект, но переназначение ссылки — нет.

---

## **4.1.7.7 Значение `null` и отсутствие объекта**

- `null` — это допустимое значение _любой переменной ссылочного типа_.
    
- Оно обозначает отсутствие связи с объектом.
    
- Попытка обращения к методу или полю через `null` вызывает `NullPointerException`.
    

Подробнее: [[4.3.1 Null Type]]

---

## **4.1.7.8 Тип и размещение в памяти**

|Категория типа|Пример|Представление в памяти|
|---|---|---|
|Примитивный тип|`int x = 5;`|значение `5` хранится прямо|
|Классовый тип|`Point p;`|`p` хранит ссылку, объект Point — в куче|
|Массив|`int[] a;`|ссылка хранится в стеке, массив — в куче|
|Enum|`Color.RED`|ссылка на заранее созданный объект enum|
|Record|`Point(int x, int y)`|объект в куче, поля неизменяемы|

---

## **4.1.7.9 Вывод**

- Тип определяет **не только набор допустимых значений**, но и **их представление в памяти JVM**.
    
- Примитивы существуют как непосредственные значения.
    
- Все сложные данные являются объектами и размещаются в куче.
    
- Ссылки на объекты передаются по значению.
    
- Понимание этой модели необходимо для анализа поведения программы, предотвращения ошибок (`NullPointerException`, `ClassCastException`) и понимания полиморфизма.
    

---

## **Cross-References**

- См. также:
    
    - **[[4.1.3 High-Level Classification of Types]]** — разделение на примитивные и ссылочные типы.
        
    - **[[4.1.5 Static vs Runtime Type]]** — влияние типа на поведение во время выполнения.
        
    - **[[4.1.6 Subtypes and Supertypes]]** — совместимость ссылочных типов.
        
    - **[[4.3 Reference Types and Values]]** — структуры ссылочных объектов.
        
    - **[[4.2 Primitive Types and Values — Примитивные типы и их значения]]** — специфика примитивов.
        
