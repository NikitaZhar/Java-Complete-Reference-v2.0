2025-10-10 12:04
Tags: #Types #Values #Variables #toCheck 

# Назначение и охват
Эта глава формализует понятия **типа**, **значения** и **переменной** в Java, а также их взаимосвязи. Она вводит классификацию типов (примитивные и ссылочные), определяет множества значений, описывает роли переменных и даёт основу для последующих глав о преобразованиях типов, выражениях, методах, обобщениях и системе вывода типов.

Цель главы — предоставить единый, строгий понятийный аппарат, которым далее пользуется спецификация языка.

# Термины и определения
- **Тип** (`type`) — формальное ограничение на множество допустимых значений и операций над ними. Тип определяется на этапе компиляции (статически), а также, для ссылочных типов, может иметь фактический **исполняемый тип** (`runtime type`) объекта во время выполнения.
- **Значение** (`value`) — элемент множества, допустимого для данного типа. В Java каждое выражение имеет тип и при вычислении даёт значение этого типа (или вызывает исключение).
- **Переменная** (`variable`) — именованная ячейка хранения значения с объявленным типом, чья область видимости и срок жизни определяются контекстом объявления.
- **Примитивный тип** (`primitive type`) — встроенный тип, значения которого представляются непосредственно (например, `int`, `double`, `boolean`, `char`).
- **Ссылочный тип** (`reference type`) — тип, значения которого являются ссылками на объекты или специальной ссылкой `null`. Включает **классы**, **интерфейсы**, **массивы** и **типовые переменные** (`type variables`).
- **Объект** (`object`) — сущность времени выполнения, размещённая в куче (`heap`), на которую указывают ссылочные значения.
- **`null`-ссылка** — единственный представитель особого «null-типа»; может назначаться переменной любого ссылочного типа и означает отсутствие привязки к объекту.
- **Литерал класса** (`class literal`) — значение ссылочного типа `Class` (например, `String.class`, `int.class`), соответствующее объекту-метаданным типа.
- **Типовая переменная** (`type variable`) — параметр обобщённого типа или метода, участвует в проверке типов и может иметь ограничения (`bounds`).
- **Параметризованный тип** (`parameterized type`) — применение обобщённого типа с конкретными аргументами типов (например, `List<String>`).
- **Стирание типов** (`type erasure` — процесс, посредством которого обобщённые типы транслируются в форму без параметризации для байткода, с сохранением гарантий типобезопасности на этапе компиляции.
- **Восстанавливаемый тип** (`reifiable type`) — тип, информация о котором полностью доступна во время выполнения (например, необобщённые классы, массивы примитивов).
- **«Сырой» тип** (`raw type`) — имя обобщённого типа без указания параметров (например, `List`), сохраняемое для совместимости. Использование ограничено.
- **Пересечённый тип** (`intersection type`) — тип, удовлетворяющий всем составляющим ограничениям (например, `T extends A & B`).
- **Подтип** (`subtype`) и **надтип** (`supertype`) — отношение совместимости типов, определяющее, где значение одного типа может использоваться вместо другого.

# Таксономия типов и значений
Java различает два рода типов:

1. **Примитивные типы** — задают конечные или формально определённые множества непосредственных значений (целые, числа с плавающей точкой, булевы значения, знаки `char`).
2. **Ссылочные типы** — их значения являются **ссылками** на объекты либо `null`. Ссылочные типы включают:
    - `class types` (в т.ч. вложенные, локальные и анонимные классы),
    - `interface types` (включая функциональные интерфейсы),
    - `array types`,
    - `type variables` (параметры обобщений).

Соответственно, различают **примитивные значения** и **ссылочные значения**. Специальное значение `null` относится к ссылочным значениям и несовместимо с примитивными типами. Отдельно выделяются **литералы класса** как значения ссылочного типа `Class`.

# Литералы и представления значений
В Java определён синтаксис **литералов**, непосредственно обозначающих значения:

- целочисленные: `0`, `42`, `0xFF`, `0b1010`, с поддержкой `_` как разделителя;
- числа с плавающей точкой: `3.14`, `1e-9`, `2.0f`;
- символьные: `'A'`, `'\u0041'`;
- логические: `true`, `false`;
- строковые: `"hello"`, с экранированием;
- `null`: специальный литерал ссылочного домена;
- литералы класса: `String.class`, `int.class`.

Более подробно про литералы см.  [[3.10 Literals (to Format)]] (уточнить)

Реальные представления и диапазоны значений примитивных типов, а также особенности вычислений (например, `NaN`, `Infinity` для `float`/`double`) формализуются в 4.2 (уточнить).

# Переменные: роль, свойства и виды
Переменная объявляется с типом, именем и (опционально) инициализатором. В Java различают:

- **поля экземпляра** (`instance fields`) и **поля класса** (`static fields`),
- **локальные переменные** (`local variables`),
- **параметры методов и конструкторов**,
- **компоненты массивов**,
- **параметры исключений** (`catch parameters`),
- **переменные шаблонов** (`pattern variables`) для конструкций сопоставления с образцом (если используются в версии языка).

Каждой переменной (кроме явно инициализированных локальных) приписывается **значение по умолчанию** согласно её типу (например, `0`, `false`, `null`). Точные правила инициализации, значения по умолчанию, а также ограничения на использование **неопределённо инициализированных** локальных переменных определены в 4.11–4.12 (уточнить).

# Статический и исполняемый тип
- **Статический тип** выражения или переменной — результат проверки типов компилятором.
- **Исполняемый тип** (`runtime type`) имеет смысл для ссылочных значений и соответствует фактическому классу объекта в куче.
- Для ссылок действует **полиморфизм**: статический тип задаёт гарантии компилятора, а исполняемый тип — конкретное поведение методов при динамической диспетчеризации.

# Совместимость типов и преобразования
Совместимость и преобразования типов определяют, можно ли использовать значение одного типа в контексте другого. В Java различают:

- **Расширяющие** (`widening`) **преобразования** — безопасные (например, `int → long`, `float → double`, подтип → надтип).
- **Сужающие** (`narrowing`) **преобразования** — потенциально небезопасные, требуют явного приведения.
- **Автоупаковку/распаковку** (`boxing/unboxing`) между примитивами и соответствующими оболочками (например, `int ↔ Integer`).
- **Контекстные преобразования** (`assignment`, `casting`, `method invocation`, `string conversion` и др.), применяемые в строго определённых местах.

Подробности и строгие правила приводятся в главе 5 (приведения, контексты, перегрузка, инференс): см. гл. 5 (Уточнить).

Примеры
```java
// Примитивное значение и переменная
int n = 42;           // тип: int, значение: 42

// Ссылочное значение и null
String s = null;      // тип: String (ссылочный), значение: null
s = "hello";          // теперь s ссылается на объект String в куче

// Литерал класса как значение ссылочного типа Class
Class<String> c = String.class;

// Автоупаковка и распаковка
Integer i = n;        // boxing: int -> Integer
int m = i;            // unboxing: Integer -> int
```

## [[4.1 The Kinds of Types and Values (to format)]]
Обзор рода типов (примитивные/ссылочные), их значения; `null` и литералы класса как особые значения; связь со следующими разделами.

## [[4.2 Primitive Types and Values — Примитивные типы и их значения]]
Полный перечень примитивных типов, их диапазоны, представление, операции, особенности вычислений (включая IEEE 754).

4.3 Reference Types and Values
Классы, интерфейсы, массивы, типовые переменные; `null`-ссылка; тождество и равенство ссылок.

4.4 Type Variables
Объявления и ограничения (bounds), роль в проверке типов.

4.5 Parameterized Types
Применение обобщённых типов, инвариантность/ковариантность массивов vs. инвариантность обобщений (обзорно, без выхода за рамки главы).

4.6 Type Erasure
Стирание типов и его следствия для времени выполнения.

4.7 Reifiable Types
Понятие «восстанавливаемости» типа в runtime и ограничения.
    
4.8 Raw Types
«Сырые» типы, совместимость и риск потери типобезопасности.

4.9 Intersection Types
Пересечённые типы и их использование в ограничениях.

4.10 Type Inference
Вывод типов при вызове обобщённых методов и конструкциях с `var` (где применимо ссылочно на соответствующие правила).

4.11 Variables
Объявление переменных, области видимости, сроки жизни.

4.12 Kinds of Variables
Виды переменных (поля экземпляра/класса, локальные, параметры, компоненты массивов, параметры исключений, переменные шаблонов), инициализация и значения по умолчанию (обзор; деталь — в подразделе).
