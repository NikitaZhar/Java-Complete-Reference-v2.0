2025-11-25 18:26
Tags: #PrimitiveTypes #toFormat 

Операции над примитивными типами определяют фундамент вычислительной модели Java.  
Они включают арифметику, сравнение, логические операции, сдвиги, правила продвижения типов (promotions), преобразования (conversions), порядок вычисления и compile-time поведение.

---

# **4.2.11.1 Категории примитивных типов**

Все примитивные типы делятся на три группы:

1. **Целочисленные**: `byte`, `short`, `int`, `long`, `char`
    
2. **С плавающей точкой**: `float`, `double`
    
3. **Логические**: `boolean`
    

Целочисленные и floating-point типы участвуют в арифметике.  
`boolean` — **не числовой**: доступна только логика.

---

# **4.2.11.2 Promotions (JLS §5.6)**

Продвижения типов автоматически применяются при работе с выражениями.

## **4.2.11.2.1 Unary Numeric Promotion**

Унарные `+` и `-`:

- `byte`, `short`, `char` → **int**
    
- `int` остаётся `int`
    
- `long`, `float`, `double` сохраняют тип
    

```java
byte b = 5;
int r = -b;
```

---

## **4.2.11.2.2 Binary Numeric Promotion**

При бинарных операциях:

|Операнды|Результат|
|---|---|
|один — `double`|`double`|
|иначе один — `float`|`float`|
|иначе один — `long`|`long`|
|иначе|`int`|

```java
char c = 'A';
short s = 5;
int r = c + s; // int
```

---

# **4.2.11.3 Arithmetic Operations (JLS §15.17)**

Операторы: `+`, `-`, `*`, `/`, `%`.

Типы:

- целые: работает двухкомплементарная арифметика
    
- floating-point: IEEE 754 (Infinity, NaN)
    

---

## **4.2.11.3.1 Integer Overflow**

```java
int x = Integer.MAX_VALUE + 1; // wrap-around
```

Нет исключений.

---

## **4.2.11.3.2 Floating Overflow / Underflow**

```java
double a = 1e308 * 1e308; // Infinity
double b = 1e-324 / 2;    // 0.0 (underflow)
```

---

# **4.2.11.4 Division and %**

### Целочисленное:

```java
5 / 2  → 2
-5 / 2 → -2
5 % 2  → 1
-5 % 2 → -1  // знак от первого операнда
```

### Floating-point:

```java
1.0 / 0.0 → Infinity
0.0 / 0.0 → NaN
```

---

# **4.2.11.5 Increment / Decrement**

```java
int x = 5;
int y = x++; // y = 5, x = 6
```

`++`/`--` недоступны для `boolean`.

---

# **4.2.11.6 Unary Operators**

- `+` / `-` — только численные типы
    
- `!` — только `boolean`
    
- `~` — только целочисленные типы
    

```java
int x = ~0;  // -1
boolean b = !true;
```

---

# **4.2.11.7 Bitwise Operations**

Доступно для всех целочисленных типов (`byte`, `short`, `char`, `int`, `long`) и частично для `boolean`.

- `&`
    
- `|`
    
- `^`
    
- `~`
    
- `<<`, `>>`, `>>>`
    

Сдвиговое расстояние:

- `% 32` для `int`
    
- `% 64` для `long`
    

---

# **4.2.11.8 Relational Operations**

Только численные типы:

```java
3 < 5  // true
'f' > 'a' // true
```

Floating-point:

```java
Double.NaN < 1   → false
Double.NaN >= 1  → false
Double.NaN == 1  → false
```

---

# **4.2.11.9 Equality Operations**

### Числа:

```java
3 == 3.0 // true
```

### boolean:

```java
true == false // false
```

### Особые случаи IEEE:

```java
Double.NaN == Double.NaN // false
0.0 == -0.0              // true
```

---

# **4.2.11.10 Logical Operations**

`boolean`:

Short-circuit: `&&`, `||`  
Non-short-circuit: `&`, `|`, `^`

```java
(obj != null) && obj.isValid(); // безопасно
(obj != null) &  obj.isValid(); // может вызвать NPE
```

---

# **4.2.11.11 Assignment (присваивание)**

### Простое:

```java
int x = 10;
```

### Составные:

`+=`, `-=`, `*=`, `/=`, `%=`  
`&=`, `|=`, `^=`  
`<<=`, `>>=`, `>>>=`

Особенность:

```java
byte b = 5;
b += 200;     // OK (с implicit cast)
b = b + 200;  // ошибка (int → byte)
```

---

# **4.2.11.12 Ternary Operator**

Тип результата определяется правилами promotions.

```java
boolean cond = true;
double r = cond ? 1 : 1.0; // double
```

---

# **4.2.11.13 Numeric Conversions (JLS §5.1)**

### Widening:

- byte → short → int → long → float → double
    
- char → int → long → float → double
    

### Narrowing (явный cast):

```java
int x = 130;
byte b = (byte) x; // -126
```

---

# **4.2.11.14 Exceptional Cases (поведение при ошибках)**

### Integer:

```java
int x = 1 / 0; // ArithmeticException
```

### Floating-point:

- деление на 0 → Infinity
    
- недопустимые операции → NaN
    
- исключения **не генерируются**
    

---

# **4.2.11.15 Constant Expressions (JLS §15.28)**

Java вычисляет _константные выражения_ на этапе компиляции.

### **Compile-time folding**

```java
final int a = 2;
final int b = 3;
int c = a * b; // 6 — вычислено компилятором
```

### **Overflow при компиляции**

```java
int x = 2147483647 + 10; // x = -2147483639 (compile-time overflow)
```

### **Constant narrowing разрешён**

```java
final int v = 100;
byte b = v; // OK — compile-time constant fits in byte
```

Но:

```java
int v = 100;
byte b = v; // ошибка
```

### **Constant string concatenation**

```java
String s = "Hello, " + "World"; // вычислено компилятором
```

---

# **4.2.11.16 Evaluation Order and Side Effects (JLS §15.7)**

Java гарантирует **строгий порядок вычисления**:

### **1. Лево-направо вычисление операндов**

```java
int i = 0;
int r = f(i++) + g(i++);
// порядок вызовов: f → g
```

### **2. Нет undefined behavior (в отличие от C/C++)**

```java
int a = 1;
a = a++ + ++a; // определённое поведение: 1 + 3 = 4
```

### **3. Side effects происходят в фиксированном порядке**

```java
int x = 2;
int y = x++ + x++ + x++; 
// 2 + 3 + 4 = 9
```

### **4. Short-circuiting влияет на сайд-эффекты**

```java
boolean b = false && (++x > 0); // ++x не выполняется
```

---

# **4.2.11.17 Типичные ошибки**

- ожидание, что `boolean` работает как 0/1
    
- `&` вместо `&&`, `|` вместо `||`
    
- игнорирование promotions (результат `char + short` — `int`)
    
- сравнение float/double через `==`
    
- бесконтрольное narrowing conversion
    
- переполнение int/long
    
- путаница `>>` и `>>>`
    
- ошибки сайд-эффектов в сложных выражениях
    

---

# **4.2.11.18 Практические рекомендации**

- Для арифметики — `int`, для больших диапазонов — `long`.
    
- Проверяйте переполнение: `Math.addExact`, `Math.multiplyExact`.
    
- Для сравнения floating-point используйте epsilon.
    
- Избегайте сложных выражений с сайд-эффектами.
    
- Используйте `&&`/`||`, а не `&`/`|`.
    
- Всегда явно кастуйте narrowing conversions.
    

---

# **4.2.11.19 Мини-схема**

```
4.2.11 Operations on Primitive Types
    ├─ Promotions (unary, binary)
    ├─ Arithmetic
    ├─ Division and modulo
    ├─ Unary operators
    ├─ Bitwise ops & shifts
    ├─ Relational ops
    ├─ Equality ops
    ├─ Logical ops (short-circuit)
    ├─ Assignment ops
    ├─ Ternary
    ├─ Numeric conversions
    ├─ Constant expressions
    ├─ Evaluation order & side effects
    ├─ Exception behavior
    └─ Recommendations
```

---

Раздел полностью завершён и полностью согласован с архитектурой твоего справочника и JLS.

Хочешь — подготовлю **4.2.12 String Conversions** или начну **главу 4.3 Reference Types**.