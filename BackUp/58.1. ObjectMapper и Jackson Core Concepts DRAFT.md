2025-10-22 20:51
Tags: #ObjectMapper #Jackson

## 58.1.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Jackson

Jackson —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π:

| –£—Ä–æ–≤–µ–Ω—å       | –ú–æ–¥—É–ª—å                                                        | –°—É—Ç—å                                                                         | –ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å                                  |
| ------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------------ |
| Streaming API | `jackson-core` (`JsonFactory`, `JsonParser`, `JsonGenerator`) | –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏ JSON (–º–∏–Ω–∏–º—É–º –∞–ª–ª–æ–∫–∞—Ü–∏–π, –º–∞–∫—Å–∏–º—É–º –∫–æ–Ω—Ç—Ä–æ–ª—è) | –û–≥—Ä–æ–º–Ω—ã–µ –ø–æ—Ç–æ–∫–∏, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞/–ø–∞–º—è—Ç—å     |
| Tree Model    | `jackson-databind` (`JsonNode`, `ObjectMapper`)               | –î—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ JSON                                               | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å—Ö–µ–º—ã, –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ JSON –∫–∞–∫ –¥–µ—Ä–µ–≤–æ–º |
| Data Binding  | `jackson-databind` (`ObjectMapper`)                           | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ JSON ‚Üî Java POJO/record                                       | 95% –ø—Ä–∏–∫–ª–∞–¥–Ω—ã—Ö –∑–∞–¥–∞—á, –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, DTO      |

`ObjectMapper` ‚Äî ¬´—Ñ–∞—Å–∞–¥¬ª –Ω–∞–¥ `Tree Model` –∏ `Data Binding`; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `JsonFactory` –∏–∑ `jackson-core` –≤–Ω—É—Ç—Ä—å.

**–§–æ—Ä–º–∞–ª—å–Ω–æ –æ —Ç–∏–ø–∞—Ö:** –ø—Ä–∏ data `binding Jackson` –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –≤—ã–≤–µ—Å—Ç–∏ —Ü–µ–ª—å–Ω—ã–π —Ç–∏–ø (JLS ¬ß4 ¬´Types¬ª, ¬ß18 ¬´Generics¬ª) ‚Äî –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ –∫–∞—Ä—Ç –Ω—É–∂–µ–Ω _—Ä–µ–∞–ª—å–Ω—ã–π_ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø (–Ω–∞–ø—Ä–∏–º–µ—Ä, `List<Foo>`), –∞ –Ω–µ —Å—ã—Ä–æ–π `List`.

## 58.1.2. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- `ObjectMapper` –ø–æ—Å–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω** –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **—Å–æ–∑–¥–∞–≤–∞—Ç—å –æ–¥–∏–Ω –±–∏–Ω** (Singleton) –∏–ª–∏ –ø—É–ª, –∞ –Ω–µ –∏–Ω—Å—Ç–∞–Ω—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
    
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏: –º–æ–¥—É–ª–∏ (`registerModule`), —Ñ–∏—á–∏ (`enable/disable`), –≤–∏–¥–∏–º–æ—Å—Ç—å (`setVisibility`), —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–º—ë–Ω, —Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã/–¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã.
    

## 58.1.3. –ö–ª—é—á–µ–≤—ã–µ –º–æ–¥—É–ª–∏ –∏ –æ–ø—Ü–∏–∏

- **`JavaTimeModule`** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `java.time` API (`Instant`, `LocalDate`, `ZonedDateTime` –∏ —Ç.–ø.).
    
- **Features** (`SerializationFeature`, `DeserializationFeature`, `MapperFeature`) ‚Äî —Ç–æ—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä—ã:
    
    - `FAIL_ON_UNKNOWN_PROPERTIES` (–æ–±—ã—á–Ω–æ **disable** –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö)
        
    - `WRITE_DATES_AS_TIMESTAMPS` (–æ–±—ã—á–Ω–æ **disable**, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å ISO-8601)
        
- **–í–∏–¥–∏–º–æ—Å—Ç—å –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏**:
    
    - `@JsonProperty`, `@JsonIgnore`, `@JsonInclude`, `@JsonFormat`
        
    - `@JsonCreator` –¥–ª—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤/—Ñ–∞–±—Ä–∏–∫; –¥–ª—è **records** –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ —á–∞—Å—Ç–æ –Ω–µ –Ω—É–∂–Ω—ã ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –º–∞–ø–ø—è—Ç—Å—è –ø–æ –∏–º–µ–Ω–∏.
        

## 58.1.4. –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–π data binding (`@JsonTypeInfo`, `@JsonSubTypes`) —É–¥–æ–±–µ–Ω, –Ω–æ **–æ–ø–∞—Å–µ–Ω** –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ ¬´default typing¬ª –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤–æ–∑–º–æ–∂–Ω—ã gadget-–∞—Ç–∞–∫–∏). –ü—Ä–∏–Ω—Ü–∏–ø—ã:
    
    - –ù–µ –≤–∫–ª—é—á–∞—Ç—å ¬´–≤—Å—ë –ø–æ–¥—Ä—è–¥¬ª (`activateDefaultTyping`) –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
        
    - –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∑–∞–∫—Ä—ã—Ç–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–µ–π (sealed), —è–≤–Ω—ã–º–∏ –ø–æ–¥—Ç–∏–ø–∞–º–∏, –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.
        

---

### ‚úî –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

**(1) –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å JavaTime –∏ –∏–≥–Ω–æ—Ä–æ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–æ–ª–µ–π**

```java
ObjectMapper MAPPER = new ObjectMapper()
    .registerModule(new JavaTimeModule())
    .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES)
    .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS);
```

**(2) –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–µ–Ω—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π**

```java
ObjectMapper MAPPER = new ObjectMapper()
    .setSerializationInclusion(JsonInclude.Include.NON_NULL)
    .setVisibility(PropertyAccessor.FIELD, JsonAutoDetect.Visibility.ANY);
```

**(3) –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —è–≤–Ω—ã–π –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º**

```java
@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = "kind")
@JsonSubTypes({
  @JsonSubTypes.Type(value = Dog.class, name = "dog"),
  @JsonSubTypes.Type(value = Cat.class, name = "cat")
})
sealed interface Pet permits Dog, Cat {}
record Dog(String name) implements Pet {}
record Cat(String name) implements Pet {}
```

### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

**(E1) –°–æ–∑–¥–∞–Ω–∏–µ `ObjectMapper` –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)**

```java
// –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω: —Ç—è–∂—ë–ª–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ + –ø–æ—Ç–µ—Ä—è –∫—ç—à–µ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
String json = new ObjectMapper().writeValueAsString(obj);
```

_–ü—Ä–æ–±–ª–µ–º–∞:_ –ª–∏—à–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏, –ø–æ—Ç–µ—Ä—è –±–µ–Ω–µ—Ñ–∏—Ç–æ–≤ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**(E2) –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π ¬´default typing¬ª –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö**

```java
ObjectMapper M = new ObjectMapper();
M.activateDefaultTyping(M.getPolymorphicTypeValidator(), ObjectMapper.DefaultTyping.EVERYTHING);
// –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–æ –¥–ª—è –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö JSON
```

_–ü—Ä–æ–±–ª–µ–º–∞:_ —Ä–∏—Å–∫ gadget-–∏–Ω—ä–µ–∫—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —è–≤–Ω—ã–π –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –∏ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø—ã.

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ò–≥–Ω–æ—Ä `JavaTimeModule` ‚Üí –¥–∞—Ç—ã –∫–∞–∫ —á–∏—Å–ª–∞ —ç–ø–æ—Ö–∏ –∏–ª–∏ –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.
    
- –°–ª—É—á–∞–π–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ `WRITE_DATES_AS_TIMESTAMPS` ‚Üí –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã.
    
- –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∏–º—ë–Ω (snake_case ‚Üî camelCase) –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.
    
- –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º ¬´–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é¬ª –±–µ–∑ –±–µ–ª—ã—Ö —Å–ø–∏—Å–∫–æ–≤ —Ç–∏–ø–æ–≤ ‚Äî **–Ω–µ–ª—å–∑—è** –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö.
    

## 58.1.5. Streaming API (JsonParser / JsonGenerator)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ.** –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ JSON-—Ç–æ–∫–µ–Ω–æ–≤ –±–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–µ—Ä–µ–≤–∞ –≤ –ø–∞–º—è—Ç—å. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏; –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.

### –ü–æ—à–∞–≥–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (JsonParser)

```java
var factory = JsonFactory.builder().build();
try (var in = Files.newInputStream(Path.of("input.json"));
     var parser = factory.createParser(in)) {

    while (parser.nextToken() != null) {
        JsonToken t = parser.currentToken();
        switch (t) {
            case FIELD_NAME -> {
                String name = parser.currentName();
                // –ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–µ/–ø—Ä–æ—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ
            }
            case VALUE_STRING -> {
                String s = parser.getText(); // –Ω–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ–º –Ω–∏—á–µ–≥–æ –ª–∏—à–Ω–µ–≥–æ
                // –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏
            }
            case VALUE_NUMBER_INT -> {
                long v = parser.getLongValue();
            }
            case START_OBJECT, END_OBJECT, START_ARRAY, END_ARRAY -> {
                // –∫–æ–Ω—Ç—Ä–æ–ª—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã/–≥–ª—É–±–∏–Ω—ã
            }
            default -> { /* –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –Ω–µ—Å—É—â. –¥–ª—è –Ω–∞—Å —Ç–∏–ø—ã */ }
        }
    }
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–ª—å—à–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ –±–µ–∑ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (JsonGenerator)

```java
var factory = JsonFactory.builder().build();
try (var out = Files.newBufferedWriter(Path.of("dump.json"), StandardCharsets.UTF_8);
     var gen = factory.createGenerator(out)) {
    gen.writeStartArray();                 // [
    for (Record e : streamRecords()) {     // –ª—é–±–∞—è –ª–µ–Ω–∏–≤–æ –∏—Ç–µ—Ä–∏—Ä—É–µ–º–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è
        gen.writeStartObject();            // {
        gen.writeStringField("id", e.id());
        gen.writeNumberField("value", e.value());
        gen.writeEndObject();              // }
    }
    gen.writeEndArray();                   // ]
    gen.flush();                           // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å
}
```

### –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è ¬´–Ω–∞ –ª–µ—Ç—É¬ª: –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è

```java
var inFactory  = JsonFactory.builder().build();
var outFactory = JsonFactory.builder().build();
try (var in = Files.newInputStream(Path.of("big.json"));
     var out = Files.newBufferedWriter(Path.of("filtered.json"), StandardCharsets.UTF_8);
     var p = inFactory.createParser(in);
     var g = outFactory.createGenerator(out)) {

    if (p.nextToken() != JsonToken.START_ARRAY) throw new IllegalStateException("expect array");
    g.writeStartArray();
    while (p.nextToken() == JsonToken.START_OBJECT) {
        g.writeStartObject();
        while (p.nextToken() != JsonToken.END_OBJECT) {
            if (p.currentToken() == JsonToken.FIELD_NAME) {
                String name = p.getCurrentName();
                p.nextToken(); // –ø–µ—Ä–µ–π—Ç–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—é
                if (name.equals("id") || name.equals("createdAt")) {
                    g.writeFieldName(name);
                    g.copyCurrentEvent(p); // –Ω–µ —á–∏—Ç–∞–µ–º –≤ String/Instant ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
                } else {
                    p.skipChildren(); // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                }
            }
        }
        g.writeEndObject();
    }
    g.writeEndArray();
}
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (–µ—â—ë 3)

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã —á—Ç–µ–Ω–∏—è (DoS-–∑–∞—â–∏—Ç–∞):**
    

```java
var factory = JsonFactory.builder()
    .streamReadConstraints(StreamReadConstraints.builder().maxDepth(100).build())
    .build();
```

2. **–ß—Ç–µ–Ω–∏–µ —á–∏—Å–µ–ª –∫–∞–∫ BigDecimal –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏:**
    

```java
var factory = JsonFactory.builder()
    .enable(JsonReadFeature.USE_BIG_DECIMAL_FOR_FLOATS.mappedFeature())
    .build();
```

3. **–ó–∞–ø–∏—Å—å UTF-8 –Ω–∞–ø—Ä—è–º—É—é –≤ OutputStream (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫):**
    

```java
try (var out = Files.newOutputStream(Path.of("out.json"));
     var gen = JsonFactory.builder().build().createGenerator(out)) {
    gen.writeStartObject();
    gen.writeStringField("status", "ok");
    gen.writeEndObject();
}
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ù–µ –∑–∞–∫—Ä—ã—Ç –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä ‚Üí –ø–æ–≤—Ä–µ–∂–¥—ë–Ω JSON (–Ω–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–∏):**
    

```java
var gen = new JsonFactory().createGenerator(System.out);
gen.writeStartArray();
gen.writeString("x");
// –∑–∞–±—ã–ª–∏ gen.writeEndArray(); –∏ close()
```

- **E2. –ò–≥–Ω–æ—Ä —Ç–∏–ø–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —á—Ç–µ–Ω–∏–µ ¬´–Ω–µ —Ç–æ–≥–æ¬ª –∑–Ω–∞—á–µ–Ω–∏—è (runtime):**
    

```java
if (parser.nextToken() == JsonToken.VALUE_NUMBER_INT) {
    String s = parser.getText(); // –¥–æ–ø—É—Å—Ç–∏–º–æ, –Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ –æ—à–∏–±–∫–∞: –æ–∂–∏–¥–∞–µ—Ç—Å—è —á–∏—Å–ª–æ
    // –ø–æ–∑–¥–Ω–µ–µ ClassCast/–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏
}
```

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Streaming):**

- –í—Å–µ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ `JsonGenerator`/`JsonParser` (try-with-resources).
    
- –ù–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å –Ω–∞ `getText()` –¥–ª—è —á–∏—Å–µ–ª, –µ—Å–ª–∏ –≤–∞–∂–Ω–∞ —Ç–æ—á–Ω–æ—Å—Ç—å/–¥–∏–∞–ø–∞–∑–æ–Ω.
    
- –í–∫–ª—é—á–∞–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è `StreamReadConstraints` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏/–¥–ª–∏–Ω–Ω—ã—Ö —á–∏—Å–µ–ª.
    

---

## 58.1.6. Tree Model (JsonNode) ‚Äî –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ.** –†–∞–±–æ—Ç–∞ —Å JSON –∫–∞–∫ —Å –∏–∑–º–µ–Ω—è–µ–º—ã–º –¥–µ—Ä–µ–≤–æ–º (`ObjectNode`, `ArrayNode`), –∫–æ–≥–¥–∞ —Å—Ö–µ–º–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–∞–≤–∫–∞ –Ω–∞ –ª–µ—Ç—É.

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —É–∑–ª–∞ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ

```java
ObjectMapper mapper = new ObjectMapper();
ObjectNode root = (ObjectNode) mapper.readTree("""
  {"user":{"id":"u1","name":"Ann","roles":["USER","ADMIN"]},"meta":{"v":1}}
""");

// –ú–µ–Ω—è–µ–º –∏–º—è
((ObjectNode) root.path("user")).put("name", "Anna");

// –£–¥–∞–ª—è–µ–º —Ä–æ–ª—å ADMIN
ArrayNode roles = (ArrayNode) root.at("/user/roles");
for (int i = 0; i < roles.size(); i++) {
    if (roles.get(i).asText().equals("ADMIN")) { roles.remove(i); break; }
}

// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ
root.with("meta").put("updated", true);

String out = mapper.writerWithDefaultPrettyPrinter().writeValueAsString(root);
```

### –£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞ –ø–æ JSON Pointer –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ –ø—É—Ç–∏

```java
ObjectNode root = (ObjectNode) mapper.readTree(json);
JsonPointer ptr = JsonPointer.compile("/user/obsolete");
JsonNode parent = root.at("/user");
if (parent.isObject()) {
    ((ObjectNode) parent).remove("obsolete");
}
root.with("user").put("active", true);
```

### –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤—å–µ–≤ (merge) —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–∞–≤–æ–≥–æ

```java
ObjectNode base = (ObjectNode) mapper.readTree("""{"a":1,"b":{"x":10}}""");
ObjectNode patch = (ObjectNode) mapper.readTree("""{"b":{"y":20},"c":3}""");
base.set("b", base.with("b").setAll((ObjectNode) patch.get("b")));
patch.fields().forEachRemaining(e -> { if (!e.getKey().equals("b")) base.set(e.getKey(), e.getValue()); });
String merged = mapper.writeValueAsString(base);
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (–µ—â—ë 3)

1. **–ß—Ç–µ–Ω–∏–µ –ø–æ–¥–º–∞—Å—Å–∏–≤–∞ –∏ –º–∞–ø–ø–∏–Ω–≥ –µ–≥–æ –≤ —Ç–∏–ø:**
    

```java
JsonNode arr = mapper.readTree(json).at("/payload/items");
List<Item> items = mapper.readerFor(new TypeReference<List<Item>>(){}).readValue(arr);
```

2. **–ó–∞–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É:**
    

```java
ArrayNode a = (ArrayNode) mapper.readTree("[1,2,3]");
a.set(1, IntNode.valueOf(42)); // [1,42,3]
```

3. **–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —É–∑–ª–æ–≤ –ø–æ –∏–º–µ–Ω–∏ (–æ–¥–Ω–æ—É—Ä–æ–≤–Ω–µ–≤–æ):**
    

```java
ObjectNode o = (ObjectNode) mapper.readTree(json);
Iterator<String> it = o.fieldNames();
List<String> toRemove = new ArrayList<>();
it.forEachRemaining(f -> { if (f.startsWith("_")) toRemove.add(f); });
toRemove.forEach(o::remove);
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–∞—Å—Ç –º–∞—Å—Å–∏–≤–∞ –∫ ObjectNode (ClassCastException):**
    

```java
ObjectNode o = (ObjectNode) mapper.readTree("[1,2]"); // runtime: –Ω–µ–ª—å–∑—è
```

- **E2. –û–∂–∏–¥–∞–Ω–∏–µ, —á—Ç–æ `path()` –≤–µ—Ä–Ω—ë—Ç null (–æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç MissingNode):**
    

```java
JsonNode n = root.path("absent");
if (n == null) { /* –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è */ }
n.get("x").asText(); // NPE/–ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å isMissingNode()
```

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Tree):**

- –û—Ç–ª–∏—á–∞–π—Ç–µ `path()` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `MissingNode`) –æ—Ç `get()` (–º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å `null`).
    
- `ObjectNode`/`ArrayNode` –º—É—Ç–∏—Ä—É–µ–º—ã, `TextNode`/`IntNode` ‚Äî –Ω–µ—Ç.
    
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é: –¥–µ—Ä–µ–≤–æ = –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏; –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –ª—É—á—à–µ Streaming.
    

---

## 58.1.7. ObjectReader / ObjectWriter (–∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** `ObjectReader`/`ObjectWriter` ‚Äî –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ, –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã, ¬´–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ¬ª –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞/–Ω–∞—Å—Ç—Ä–æ–µ–∫. –£–º–µ–Ω—å—à–∞—é—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–∞—é—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å.

```java
ObjectMapper mapper = new ObjectMapper().registerModule(new JavaTimeModule());
ObjectReader reader = mapper.readerFor(new TypeReference<List<User>>() {});
ObjectWriter writer = mapper.writerWithDefaultPrettyPrinter();

try (var in = Files.newBufferedReader(Path.of("users.json"))) {
    List<User> users = reader.readValue(in); // –±–µ–∑ –ª–∏—à–Ω–∏—Ö TypeFactory –≤—ã–∑–æ–≤–æ–≤
}

String json = writer.writeValueAsString(new User("u1", "Ann", Instant.now()));
```

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Reader/Writer):**

- –ú–µ–Ω—è—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `ObjectMapper` **–ø–æ—Å–ª–µ** –ø–æ–ª—É—á–µ–Ω–∏—è `ObjectReader/ObjectWriter`, –≤—ã **–Ω–µ** –∏–∑–º–µ–Ω–∏—Ç–µ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ä–∏–¥–µ—Ä—ã/—Ä–∞–π—Ç–µ—Ä—ã.
    
- –î–µ—Ä–∂–∏—Ç–µ –∏—Ö –∫–∞–∫ final-—Å–∏–Ω–≥–ª—Ç–æ–Ω—ã/–±–∏–Ω—ã, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —á–∞—Å—Ç–æ.
    

---

## 58.1.8. Afterburner –∏ ParameterNamesModule

- **Afterburner** (`jackson-module-afterburner`) –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–∞–π—Ç–∫–æ–¥ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—è–º/–º–µ—Ç–æ–¥–∞–º.  
    **–£–º–µ—Å—Ç–Ω–æ:** –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã, –≥–æ—Ä—è—á–∏–µ DTO.  
    **–ù–µ—É–º–µ—Å—Ç–Ω–æ/–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ:** GraalVM native-image, –Ω–µ–æ–±—ã—á–Ω—ã–µ ClassLoader‚Äô—ã, —Å—Ç—Ä–æ–≥–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
    

```java
ObjectMapper mapper = new ObjectMapper()
    .registerModule(new JavaTimeModule())
    .registerModule(new AfterburnerModule());
```

- **ParameterNamesModule** –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –±–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π (—Ç—Ä–µ–±—É–µ—Ç `-parameters` –ø—Ä–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏).
    

```java
ObjectMapper mapper = new ObjectMapper()
    .registerModule(new ParameterNamesModule())
    .registerModule(new JavaTimeModule());
```

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏:**

- Afterburner –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –±–∞–π—Ç–∫–æ–¥–∞/—Å–µ–∫—å—é—Ä–∏—Ç–∏-–º–µ–Ω–µ–¥–∂–µ—Ä–æ–º.
    
- –ë–µ–∑ —Ñ–ª–∞–≥–∞ `-parameters` `ParameterNamesModule` –Ω–µ —É–≤–∏–¥–∏—Ç –∏–º–µ–Ω–∞.
    

---

## 58.1.9. JPMS (–º–æ–¥—É–ª–∏): module-info –∏ ¬´opens¬ª –¥–ª—è Jackson

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä `module-info.java`:**

```java
module com.example.app {
    requires com.fasterxml.jackson.core;
    requires com.fasterxml.jackson.databind;
    requires com.fasterxml.jackson.annotation;
    requires com.fasterxml.jackson.datatype.jsr310;

    // –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –∫ –ø–æ–ª—è–º/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º –≤ –≤–∞—à–µ–º –ø–∞–∫–µ—Ç–µ –º–æ–¥–µ–ª–µ–π
    opens com.example.model to com.fasterxml.jackson.databind;

    // –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ exports, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    exports com.example.api;
}
```

**–ó–∞–º–µ—á–∞–Ω–∏—è:**

- –£ Jackson-–±–∞–Ω–æ–∫ –µ—Å—Ç—å `Automatic-Module-Name` ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –º–æ–¥—É–ª–µ–π (`com.fasterxml.jackson.databind` –∏ –¥—Ä.).
    
- –ß–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞: –∑–∞–±—ã—Ç—å `opens` –¥–ª—è –ø–∞–∫–µ—Ç–∞ –º–æ–¥–µ–ª–µ–π ‚Äî Jackson –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ `setVisibility(FIELD, ANY)`).
    

---

## 58.1.10. –¢–∞–±–ª–∏—Ü–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è JSON ‚Üî Java —Ç–∏–ø–æ–≤ (—Å—Å—ã–ª–∫–∞ –Ω–∞ JLS)

|JSON|Java —Ç–∏–ø –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é|–ü—Ä–∏–º–µ—á–∞–Ω–∏—è (JLS)|
|---|---|---|
|object|POJO/record/`Map<String,?>`|JLS ¬ß8 (–∫–ª–∞—Å—Å—ã), ¬ß12 (records). –ü–æ–ª—è/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã/–∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏.|
|array|`List<T>` / –º–∞—Å—Å–∏–≤ `T[]`|JLS ¬ß10 (arrays), ¬ß18 (generics). –ù—É–∂–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ç–∏–ø.|
|string|`String`, —Ç–∞–∫–∂–µ `Enum`, `UUID`, `java.time`|JLS ¬ß4.3.1. –°—Ç—Ä–æ–∫–∏; –¥–ª—è Enum ‚Äî –º–∞–ø–ø–∏–Ω–≥ –ø–æ –∏–º–µ–Ω–∏; –¥–ª—è `java.time` ‚Äî `JavaTimeModule`.|
|number|`int/long/double` –∏–ª–∏ `BigDecimal/BigInteger`|JLS ¬ß5 (numeric conversions). –î–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏ ‚Äî `USE_BIG_DECIMAL_FOR_FLOATS`.|
|boolean|`boolean/Boolean`|Boxing/unboxing (JLS ¬ß5.1.7).|
|null|`null` ‚Üí —Ä–µ—Ñ–µ—Ä–µ–Ω—Å-—Ç–∏–ø—ã|–ê–≤—Ç–æ–±–æ–∫—Å–∏–Ω–≥/–∞–Ω–±–æ–∫—Å–∏–Ω–≥ –º–æ–∂–µ—Ç –¥–∞—Ç—å `NullPointerException`.|

**–ì–¥–µ –≤—Å—Ç—É–ø–∞—é—Ç JLS ¬ß4, ¬ß5, ¬ß18:**

- ¬ß4 ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤ —Ü–µ–ª–µ–≤–æ–≥–æ –ø–æ–ª—è/–ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞.
    
- ¬ß5 ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π (numeric promotions, boxing/unboxing) –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Å–µ—Ç—Ç–µ—Ä–æ–≤/–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤.
    
- ¬ß18 ‚Äî –≤—ã–≤–æ–¥ —Ç–∏–ø–æ–≤—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –¥–∂–µ–Ω–µ—Ä–∏–∫–∞—Ö: –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π `T`.
    

---

## 58.1.11. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø—Ü–∏–∏ (–∏–∑–±–µ–≥–∞—Ç—å –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö):**

- `activateDefaultTyping(...)` / ¬´base polymorphic deserialization¬ª –±–µ–∑ –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞.
    
- –†–∞–∑—Ä–µ—à–µ–Ω–∏—è: `JsonReadFeature.ALLOW_UNQUOTED_FIELD_NAMES`, `ALLOW_SINGLE_QUOTES` ‚Äî –¥–µ–ª–∞—é—Ç –ø–∞—Ä—Å–µ—Ä –±–æ–ª–µ–µ ¬´–ø–æ–ø—É—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–º¬ª.
    
- –ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –±–µ–∑ —è–≤–Ω—ã—Ö `@JsonSubTypes`.
    

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DoS:**

```java
var factory = JsonFactory.builder()
    .streamReadConstraints(StreamReadConstraints.builder()
        .maxDepth(100)
        .maxNumberLength(1000)
        .maxNameLength(1000)
        .build())
    .build();
```

---

## 58.1.12. –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ Jackson ‚Äî —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

|–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã/–∑–∞–º–µ—Ç–∫–∏|
|---|---|---|
|`@JsonProperty`|–Ø–≤–Ω–æ–µ –∏–º—è —Å–≤–æ–π—Å—Ç–≤–∞/–ø–∞—Ä–∞–º–µ—Ç—Ä–∞|–ü–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∏–º—ë–Ω|
|`@JsonIgnore`|–ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª–µ/–≥–µ—Ç—Ç–µ—Ä|–ö–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å `@JsonProperty`|
|`@JsonInclude`|–ü–æ–ª–∏—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è (NON_NULL –∏ —Ç.–¥.)|–ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–∞ –ø–æ–ª–µ|
|`@JsonCreator`|–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/—Ñ–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è|–¢—Ä–µ–±—É–µ—Ç `@JsonProperty` –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö, –µ—Å–ª–∏ –∏–º–µ–Ω–∞ –Ω–µ –≤—ã–≤–µ–¥–µ–Ω—ã|
|`@JsonValue`|–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ ¬´–∑–Ω–∞—á–µ–Ω–∏–µ¬ª —Ç–∏–ø–∞ –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏|–ö–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –ø–æ–ª—è–º–∏/–≥–µ—Ç—Ç–µ—Ä–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é|
|`@JsonAnySetter`|–°–æ–±—Ä–∞—Ç—å ¬´–ª–∏—à–Ω–∏–µ¬ª –ø–∞—Ä—ã –∏–º—è‚Üí–∑–Ω–∞—á–µ–Ω–∏–µ|–í–ª–∏—è–µ—Ç –Ω–∞ —Å—Ö–µ–º—É; –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ|
|`@JsonAnyGetter`|–í—ã–≥—Ä—É–∑–∏—Ç—å ¬´–¥–æ–ø. –ø–∞—Ä—ã¬ª –≤ JSON|–°–æ—á–µ—Ç–∞–µ—Ç—Å—è —Å `Map<String,Object>`|
|`@JsonIdentityInfo`|–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏/—Å—Å—ã–ª–æ–∫|–û—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏|
|`@JsonView`|–ü—Ä–æ–µ–∫—Ü–∏–∏ (—Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)|–¢—Ä–µ–±—É–µ—Ç `ObjectWriter.withView()`|
|`@JsonFilter`|Runtime-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª–µ–π|–ù—É–∂–µ–Ω `FilterProvider` –Ω–∞ writer|



## 58.1.13. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π (Maven/Gradle, ¬´–æ–¥–Ω–∞ —Å–µ–º—å—è¬ª)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–π_ ‚Äî —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã Jackson –æ–¥–Ω–æ–π –º–∞–∂–æ—Ä–Ω–æ–π/–º–∏–Ω–æ—Ä–Ω–æ–π –ª–∏–Ω–∏–∏ (`jackson-core`, `jackson-databind`, `jackson-annotations`, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏), —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –±–∏–Ω–∞—Ä–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (JLS ¬ß13 ‚Äî binary compatibility; –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è/–ª–∏–Ω–∫—É–µ—Ç—Å—è –∫–æ–¥).

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–æ—Å—Ç–∞–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

- –ë–∞–∑–æ–≤–æ:
    
    - `com.fasterxml.jackson.core:jackson-core`
        
    - `com.fasterxml.jackson.core:jackson-databind`
        
    - `com.fasterxml.jackson.core:jackson-annotations`
        
- –î–ª—è –≤—Ä–µ–º–µ–Ω–∏/–¥–∞—Ç:
    
    - `com.fasterxml.jackson.datatype:jackson-datatype-jsr310`
        
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
    
    - `com.fasterxml.jackson.module:jackson-module-parameter-names`
        
    - `com.fasterxml.jackson.module:jackson-module-afterburner`
        

#### Maven (—Å ¬´—Ä–æ–¥–∏—Ç–µ–ª–µ–º¬ª –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –≤–µ—Ä—Å–∏–π)

```xml
<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>com.fasterxml.jackson</groupId>
      <artifactId>jackson-bom</artifactId>
      <version>2.17.2</version><!-- –ø—Ä–∏–º–µ—Ä -->
      <type>pom</type>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>

<dependencies>
  <dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
  </dependency>
  <dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-core</artifactId>
  </dependency>
  <dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-annotations</artifactId>
  </dependency>
  <dependency>
    <groupId>com.fasterxml.jackson.datatype</groupId>
    <artifactId>jackson-datatype-jsr310</artifactId>
  </dependency>
</dependencies>
```

#### Gradle (Kotlin DSL) —Å BOM

```kotlin
dependencies {
  implementation(platform("com.fasterxml.jackson:jackson-bom:2.17.2"))
  implementation("com.fasterxml.jackson.core:jackson-databind")
  implementation("com.fasterxml.jackson.core:jackson-core")
  implementation("com.fasterxml.jackson.core:jackson-annotations")
  implementation("com.fasterxml.jackson.datatype:jackson-datatype-jsr310")
}
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BOM** –¥–ª—è –µ–¥–∏–Ω—ã—Ö –≤–µ—Ä—Å–∏–π (—Å–º. –≤—ã—à–µ).
    
2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ `jackson-datatype-jsr310`** –≤–º–µ—Å—Ç–µ —Å `registerModule(new JavaTimeModule())`.
    
3. **ParameterNamesModule** + –∫–æ–º–ø–∏–ª—è—Ü–∏—è —Å `-parameters` (—Å–º. 58.1.8).
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. ¬´–†–æ–º–∞—à–∫–∞¬ª –≤–µ—Ä—Å–∏–π** ‚Äî —Ä–∞–∑–Ω—ã–µ –º–∏–Ω–æ—Ä–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —É `databind` –∏ `core`:
    
    ```xml
    <dependency>jackson-databind:2.17.2</dependency>
    <dependency>jackson-core:2.13.5</dependency> <!-- –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ -->
    ```
    
    _–†–∏—Å–∫:_ `NoSuchMethodError`, `LinkageError` –Ω–∞ —Ä–∞–Ω—Ç–∞–π–º–µ.
    
- **E2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `jackson-annotations` –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π**  
    _–†–µ–∑—É–ª—å—Ç–∞—Ç:_ –æ—à–∏–±–∫–∏ –º–∞–ø–ø–∏–Ω–≥–∞/–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –¢–µ–Ω–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö BOM/–ø–ª–∞—Ç—Ñ–æ—Ä–º ‚Üí –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    
- Afterburner —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–π –≤–µ—Ä—Å–∏–∏ —Å –≤–∞—à–∏–º `databind`.
    
- –í –º—É–ª—å—Ç–∏-–º–æ–¥—É–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–¥–∏–Ω—ã–π BOM –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–º —É—Ä–æ–≤–Ω–µ.
    

---

## 58.1.14. –ö–æ–¥–∏—Ä–æ–≤–∫–∏ –∏ I/O (Oracle API): Charset, –ø–æ—Ç–æ–∫–∏, backpressure

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _–ö–æ–¥–∏—Ä–æ–≤–∫–∞_ ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –Æ–Ω–∏–∫–æ–¥–∞ –≤ –±–∞–π—Ç–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å. –î–ª—è JSON —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å **UTF-8** (RFC 8259). –í JDK ‚Äî `java.nio.charset.Charset`, `StandardCharsets.UTF_8`.

### –ü—Ä–∞–∫—Ç–∏–∫–∞ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏

- –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å **`UTF-8`** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å `Reader/Writer`/`Files`.
    
- –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –∏–∑–±–µ–≥–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö `String`: —Ä–∞–±–æ—Ç–∞—Ç—å —Å `InputStream`/`OutputStream` –∏–ª–∏ `Reader/Writer` –Ω–∞–ø—Ä—è–º—É—é.
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ UTF-8**:
    

```java
try (var reader = Files.newBufferedReader(Path.of("data.json"), StandardCharsets.UTF_8)) {
  JsonNode root = new ObjectMapper().readTree(reader);
}
```

2. **–ó–∞–ø–∏—Å—å –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫**:
    

```java
try (var out = Files.newOutputStream(Path.of("out.json"))) {
  new ObjectMapper().writeValue(out, dto);
}
```

3. **–ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö**:
    

```java
try (var in = new BufferedInputStream(Files.newInputStream(path))) {
  MappingIterator<Item> it = mapper.readerFor(Item.class).readValues(in);
  while (it.hasNext()) process(it.next());
}
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –°–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**:
    
    ```java
    new FileReader("data.json"); // –∏—Å–ø–æ–ª—å–∑—É–µ—Ç default charset ‚Üí –±–∞–≥–∏ –Ω–∞ non-UTF-8 —Å–∏—Å—Ç–µ–º–∞—Ö
    ```
    
- **E2. –ß—Ç–µ–Ω–∏–µ –æ–≥—Ä–æ–º–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `Files.readString`** ‚Üí –ø–∏–∫ –ø–∞–º—è—Ç–∏.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è platform default charset. –í—Å–µ–≥–¥–∞ –∑–∞–¥–∞–≤–∞–π—Ç–µ `UTF-8`.
    
- –ù–µ –≥—Ä—É–∑–∏—Ç–µ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–µ JSON –≤ —Å—Ç—Ä–æ–∫—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ç–æ–∫–æ–≤—ã–µ API Jackson (—Å–º. 58.1.5).
    

---

## 58.1.15. –ò—Å–∫–ª—é—á–µ–Ω–∏—è Jackson: —Ç–∞–∫—Å–æ–Ω–æ–º–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** –í–æ –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞/–±–∞–π–Ω–¥–∏–Ω–≥–∞ Jackson –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ò—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø—Ä–æ—â–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.

|–ò—Å–∫–ª—é—á–µ–Ω–∏–µ|–ö–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç|–¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã|
|---|---|---|
|`JsonParseException`|–°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ JSON|–ù–µ–ø–æ–ª–Ω—ã–π/–±–∏—Ç—ã–π –≤–≤–æ–¥, –ª–∏—à–Ω–∏–µ/–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã|
|`JsonMappingException`|–û—à–∏–±–∫–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è JSON ‚Üî Java|–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞|
|`MismatchedInputException`|–ß–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π mapping|–û–∂–∏–¥–∞–ª–∏ –º–∞—Å—Å–∏–≤, –ø–æ–ª—É—á–∏–ª–∏ –æ–±—ä–µ–∫—Ç –∏ —Ç.–ø.|
|`InvalidDefinitionException`|–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞|–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Ñ–∞–±—Ä–∏–∫–∏, –∫–æ–Ω—Ñ–ª–∏–∫—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π|
|`StreamConstraintsException`|–ù–∞—Ä—É—à–µ–Ω—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è|–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã/–¥–ª–∏–Ω—ã —Ç–æ–∫–µ–Ω–∞|

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å –ø—É—Ç—ë–º –ø–æ–ª—è**:
    

```java
try {
  mapper.readValue(json, Dto.class);
} catch (JsonMappingException e) {
  log.error("Mapping error at {}: {}", e.getPathReference(), e.getOriginalMessage());
}
```

2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –º–∞–ø–ø–∏–Ω–≥–∞**:
    

```java
try {
  JsonNode n = mapper.readTree(json); // parse
  Dto dto = mapper.treeToValue(n, Dto.class); // map
} catch (JsonParseException e) {
  // –°–∏–Ω—Ç–∞–∫—Å–∏—Å
} catch (JsonMappingException e) {
  // –¢–∏–ø—ã/—Å—Ö–µ–º–∞
}
```

3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞**:
    

```java
var factory = JsonFactory.builder()
  .streamReadConstraints(StreamReadConstraints.builder().maxDepth(64).build())
  .build();
try (var p = factory.createParser(json)) { /* ... */ }
catch (StreamConstraintsException e) { /* 413 Payload Too Large, –Ω–∞–ø—Ä–∏–º–µ—Ä */ }
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ì–ª–æ—Ç–∞–Ω–∏–µ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π** –∏ –≤–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ ‚Üí —Ç–∏—Ö–∞—è –ø–æ—Ä—á–∞ –¥–∞–Ω–Ω—ã—Ö.
    
- **E2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `e.getMessage()` –±–µ–∑ `getPathReference()`** ‚Üí —Ç—Ä—É–¥–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–µ.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –û—Ç–¥–µ–ª—è–π—Ç–µ –æ—à–∏–±–∫–∏ –≤–≤–æ–¥–∞ (400 Bad Request) –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ (500).
    
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º—ã –¥–æ –º–∞–ø–ø–∏–Ω–≥–∞ –º–æ–∂–µ—Ç —É–ø—Ä–æ—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É.
    

---

## 58.1.16. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: JSON-–∞—Å—Å—ë—Ä—Ç—ã, golden-files, snapshot-–ø–æ–¥—Ö–æ–¥

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _Golden file/snapshot_ ‚Äî —ç—Ç–∞–ª–æ–Ω–Ω—ã–π JSON, —Å –∫–æ—Ç–æ—Ä—ã–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –≤—ã–≤–æ–¥/–≤–≤–æ–¥; –ø–æ–º–æ–≥–∞–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–º.

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ ¬´–¥–µ—Ä–µ–≤–æ–º¬ª, –Ω–µ —Å—Ç—Ä–æ–∫–æ–π**:
    

```java
JsonNode expected = mapper.readTree(Files.readString(Path.of("golden.json")));
JsonNode actual = mapper.readTree(mapper.writeValueAsString(dto));
assertEquals(expected, actual); // —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä, –∞ –Ω–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

2. **JSONAssert (lenient)**:
    

```java
JSONAssert.assertEquals("{\"a\":1,\"b\":[1,2]}", actualJson, false);
```

3. **–ö–æ–Ω—Ç—Ä–æ–ª—å backward-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**:  
    –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—è –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ —Å—Ç–∞—Ä—ã–π –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –Ω–µ —É–ø–∞–¥—ë—Ç ‚Üí —Ç–µ—Å—Ç —Å `FAIL_ON_UNKNOWN_PROPERTIES=false`.
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ JSON** (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤/–ø–æ—Ä—è–¥–∫–∞ –ø–æ–ª–µ–π).
    
- **E2. –ù–µ–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ golden-—Ñ–∞–π–ª—ã –±–µ–∑ –æ–±–∑–æ—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Üí –ª–æ–∂–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ñ–æ—Ä–º–∞—Ç (ISO-8601, –ø–æ—Ä—è–¥–æ–∫, –≤–∫–ª—é—á–µ–Ω–∏–µ/–∏—Å–∫–ª—é—á–µ–Ω–∏–µ null), —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –Ω–µ ¬´—Ñ–ª–∏–ø–∞–ª–∏¬ª.
    
- –î–ª—è –±–æ–ª—å—à–∏—Ö JSON –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ ¬´–¥–µ—Ä–µ–≤–æ¬ª –∏ –≤—ã–±–æ—Ä–æ—á–Ω—ã–µ JSONPath-–∞—Å—Å—ë—Ä—Ç—ã.
    

---

## 58.1.17. Gson ‚Äî –º–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** Gson ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ data binding/–¥–µ—Ä–µ–≤—å–µ–≤ (`JsonElement`) –¥–ª—è JSON, –ø—Ä–æ—â–µ Jackson, –Ω–æ –æ–±—ã—á–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ; —Å–ª–∞–±–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `java.time`.

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ë–∞–∑–æ–≤–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è**:
    

```java
Gson gson = new GsonBuilder().serializeNulls().create();
String json = gson.toJson(dto);
Dto back = gson.fromJson(json, Dto.class);
```

2. **–ê–¥–∞–ø—Ç–µ—Ä –¥–ª—è `Instant`**:
    

```java
Gson gson = new GsonBuilder()
  .registerTypeAdapter(Instant.class, (JsonDeserializer<Instant>)
      (el, t, ctx) -> Instant.parse(el.getAsString()))
  .registerTypeAdapter(Instant.class, (JsonSerializer<Instant>)
      (v, t, ctx) -> new JsonPrimitive(v.toString()))
  .create();
```

3. **–î–µ—Ä–µ–≤—è–Ω–Ω–∞—è –º–æ–¥–µ–ª—å**:
    

```java
JsonObject obj = JsonParser.parseString(json).getAsJsonObject();
obj.addProperty("active", true);
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –û–∂–∏–¥–∞–Ω–∏–µ, —á—Ç–æ Gson ¬´–∑–Ω–∞–µ—Ç¬ª `java.time` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Üí `UnsupportedOperationException`.
    
- **E2. –ü–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫ JSON.**
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ú–µ–Ω—å—à–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π/–º–æ–¥—É–ª–µ–π –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å Jackson.
    
- –ë—É–¥—å—Ç–µ —è–≤–Ω—ã —Å –¥–∞—Ç–∞–º–∏/—á–∏—Å–ª–∞–º–∏.
    

---

## 58.1.18. Jakarta JSON: JSON-B –∏ JSON-P ‚Äî –º–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä—ã

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.**

- **JSON-P (JSR 374/353)** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç Jakarta –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ –∏ –æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ API (–∞–Ω–∞–ª–æ–≥ Streaming/Tree).
    
- **JSON-B (JSR 367)** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π data binding –ø–æ–≤–µ—Ä—Ö JSON-P.
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **JSON-P: –ø–æ—Ç–æ–∫–æ–≤–æ–µ —á—Ç–µ–Ω–∏–µ**:
    

```java
try (JsonParser p = Json.createParser(Files.newBufferedReader(path))) {
  while (p.hasNext()) {
    JsonParser.Event e = p.next();
    if (e == JsonParser.Event.KEY_NAME) { /* ... */ }
  }
}
```

2. **JSON-P: –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞**:
    

```java
JsonObject obj = Json.createObjectBuilder()
  .add("id", "u1")
  .add("active", true)
  .build();
```

3. **JSON-B: –±–∏–Ω–¥–∏–Ω–≥**:
    

```java
Jsonb jsonb = JsonbBuilder.create();
String json = jsonb.toJson(dto);
Dto back = jsonb.fromJson(json, Dto.class);
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –û–∂–∏–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `java.time` —Ñ–æ—Ä–º–∞—Ç–æ–≤ –±–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@JsonbDateFormat`.
    
- **E2. –°–º–µ—à–∏–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã JSON-P –æ—Ç —Ä–∞–∑–Ω—ã—Ö –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–π –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–ø–∞—Å–µ** ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞ –º–æ–≥—É—Ç —É—Å—Ç—É–ø–∞—Ç—å Jackson.
    
- –•–æ—Ä–æ—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è Jakarta EE, –≥–¥–µ –≤–∞–∂–Ω–∞ ¬´—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—Å—Ç—å¬ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
    

---

## 58.1.19. –°—Ö–µ–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è (JSON Schema)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _JSON Schema_ ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON (—Ç–∏–ø—ã, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ñ–æ—Ä–º–∞—Ç—ã), –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö **–¥–æ** data binding.

**–ü—Ä–∞–∫—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**

- –î–ª—è –≤–Ω–µ—à–Ω–∏—Ö/–Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ JSON Schema –¥–æ –±–∏–Ω–¥–∏–Ω–≥–∞ Jackson, —á—Ç–æ–±—ã:
    
    1. –æ—Ç–¥–µ–ª–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å/—Å—Ö–µ–º—É –æ—Ç –º–∞–ø–ø–∏–Ω–≥–∞;
        
    2. –≤—ã–¥–∞–≤–∞—Ç—å —á–µ–ª–æ–≤–µ–∫–æ–ø–æ–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏;
        
    3. –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π/–∑–Ω–∞—á–µ–Ω–∏–π.
        

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–°–Ω–∞—á–∞–ª–∞ —Å—Ö–µ–º–∞, –ø–æ—Ç–æ–º –±–∏–Ω–¥–∏–Ω–≥** (–ø—Å–µ–≤–¥–æ–∫–æ–¥):
    

```java
validateWithSchema(jsonBytes, schema);
Dto dto = mapper.readValue(jsonBytes, Dto.class);
```

2. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞/–≥–ª—É–±–∏–Ω—ã + —Å—Ö–µ–º–∞** ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞.
    
3. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º**: –¥–µ—Ä–∂–∏—Ç–µ `v1`, `v2` –±–æ–∫-–æ-–±–æ–∫; –¥–∞–Ω–Ω—ã–µ –Ω–µ—Å—É—â. –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–ª–µ—Ç—è—Ç –ø–æ `oneOf`.
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ü–æ–ª–∞–≥–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `FAIL_ON_UNKNOWN_PROPERTIES=false`** –∫–∞–∫ ¬´–≤–∞–ª–∏–¥–∞—Ü–∏—é¬ª.
    
- **E2. –ú–∏–∫—Å–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º –≤ –æ–¥–Ω–æ–º —ç–Ω–¥–ø–æ–π–Ω—Ç–µ –±–µ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∏–∑–∞—Ü–∏–∏.**
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π—Ç–µ —Å—Ö–µ–º—É –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏. –ß–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ –¥–æ–ª–∂–Ω–∞ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—Ä–µ–º–µ–Ω–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–∞—Ö (–∫–µ—à–∏—Ä—É–π—Ç–µ –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã).
    

---

## 58.1.20. –î–∏–∞–≥—Ä–∞–º–º—ã: –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ—Ç–æ–∫–æ–≤–∞—è –∑–∞–ø–∏—Å—å

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–¥–ª—è Obsidian)

```mermaid
sequenceDiagram
  participant Client
  participant ObjectReader
  participant JsonParser
  participant Model as Record/POJO

  Client->>ObjectReader: readValues(InputStream)
  ObjectReader->>JsonParser: iterate tokens
  JsonParser-->>ObjectReader: START_OBJECT..END_OBJECT
  ObjectReader->>Model: construct via constructor/@JsonCreator
  ObjectReader-->>Client: MappingIterator<Model>
```

### –ü–æ—Ç–æ–∫–æ–≤–∞—è –∑–∞–ø–∏—Å—å –±–æ–ª—å—à–æ–≥–æ –º–∞—Å—Å–∏–≤–∞ (O(1) RAM –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç)

```mermaid
flowchart LR
  A[Source stream] --> B[ObjectWriter/JsonGenerator]
  B --> C[[OutputStream]]
  subgraph Memory
    D[(Single element buffer)]
  end
  A --> D --> B
```


–ì–æ—Ç–æ–≤–æ. –ù–∞—á–∏–Ω–∞—é —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å **–∑–∞–≤–µ—Ä—à–∞—é—â–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã 58.1.21‚Äì58.1.25**, —Å—Ç—Ä–æ–≥–æ –≤ —Å—Ç–∏–ª–µ –≤—Å–µ–π –≥–ª–∞–≤—ã: —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è + JLS/Oracle —Å—Å—ã–ª–∫–∏ + –ø—Ä–∏–º–µ—Ä—ã (3 –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö / 2 –æ—à–∏–±–æ—á–Ω—ã—Ö) + —Ç–∞–±–ª–∏—Ü—ã + –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏.



# **58.1.21. Performance and Memory Model (–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –º–æ–¥–µ–ª—å –ø–∞–º—è—Ç–∏ Jackson)**

### **–§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ ObjectMapper**

- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (latency)** ‚Äî –≤—Ä–µ–º—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è JSON ‚Üî –æ–±—ä–µ–∫—Ç (–º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã –Ω–∞ –æ–±—ä–µ–∫—Ç).
    
- **–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (throughput)** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É.
    
- **–ú–æ–¥–µ–ª—å –ø–∞–º—è—Ç–∏** ‚Äî –æ–±—ä—ë–º –∞–ª–ª–æ–∫–∞—Ü–∏–π (heap allocation), –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ GC, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É–ª–æ–≤ –±–∞–π—Ç–æ–≤.
    

Jackson –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞:

- –ü–æ—Ç–æ–∫–æ–≤–æ–º API (`JsonParser`, `JsonGenerator`) ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∞–ª–ª–æ–∫–∞—Ü–∏–∏.
    
- Data Binding (`ObjectMapper`) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –∏–ª–∏ –±–∞–π—Ç–∫–æ–¥-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é (—á–µ—Ä–µ–∑ Afterburner).
    
- Cache –ø–ª–∞–Ω–æ–≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Serializer`, `Deserializer`, `JsonFactory`.
    

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è–Ω–∏—è**

|–ú–µ—Ö–∞–Ω–∏–∑–º|–í–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å|–ê–ª–ª–æ–∫–∞—Ü–∏–∏|–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ|
|---|---|---|---|
|Streaming API|–ú–∞–∫—Å–∏–º—É–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏|–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ|–ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å|
|ObjectMapper –±–µ–∑ –º–æ–¥—É–ª–µ–π|–ë–∞–∑–æ–≤—ã–π|–°—Ä–µ–¥–Ω–∏–µ|–†–µ—Ñ–ª–µ–∫—Å–∏—è|
|ObjectMapper + Afterburner|+15‚Äì30%|–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ|–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–π—Ç–∫–æ–¥–∞|
|ObjectReader/ObjectWriter|+5‚Äì10%|–°–Ω–∏–∂–µ–Ω–∏–µ GC|–ü—Ä–µ–¥–∫–æ–º–ø–∏–ª–µ–Ω–Ω—ã–µ –ø–ª–∞–Ω—ã|
|Records vs POJO|+5‚Äì15%|–ú–µ–Ω—å—à–µ overhead|–ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –±—ã—Å—Ç—Ä—ã–π –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏|

---

### ‚úî **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ) –ø—Ä–∏–º–µ—Ä—ã**

**(1) –ü—É–ª ObjectWriter –¥–ª—è –≥–æ—Ä—è—á–µ–≥–æ –ø—É—Ç–∏**

```java
private static final ObjectWriter WRITER =
  new ObjectMapper()
    .registerModule(new JavaTimeModule())
    .writerFor(Event.class);

public byte[] serialize(Event e) throws IOException {
  return WRITER.writeValueAsBytes(e); // –Ω—É–ª–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
}
```

**(2) –†–µ–∂–∏–º –ø–æ—Ç–æ—á–Ω–æ–π —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è O(1) –ø–∞–º—è—Ç–∏**

```java
try (SequenceWriter sw = WRITER.writeValues(outputStream)) {
  for (Event e : eventStream()) {
    sw.write(e); // –Ω–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–µ—Å—å JSON –≤ –ø–∞–º—è—Ç–∏
  }
}
```

**(3) –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Afterburner**

```java
ObjectMapper mapper = new ObjectMapper()
    .registerModule(new AfterburnerModule());
```

---

### ‚úñ **–û—à–∏–±–æ—á–Ω—ã–µ —Å—Ö–µ–º—ã (–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã)**

**(E1) –°–æ–∑–¥–∞–Ω–∏–µ ObjectMapper –Ω–∞ –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤**

```java
String json = new ObjectMapper().writeValueAsString(obj); // +200¬µs overhead
```

_–ü—Ä–æ–±–ª–µ–º–∞: –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ —Å–æ–∑–¥–∞—ë—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–µ—à–∏ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç ClassLoader._

**(E2) –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ String**

```java
String json = mapper.writeValueAsString(obj); 
outputStream.write(json.getBytes(StandardCharsets.UTF_8)); // –¥–≤–æ–π–Ω–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è
```

_–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ø–∏—Å–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ stream._

---

### **–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏ (Performance Pitfalls)**

- **–ü–∏–∫ –∞–ª–ª–æ–∫–∞—Ü–∏–π –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ writeValueAsString**.
    
- **ObjectMapper –±–µ–∑ –∫–µ—à–∞ —Ç–∏–ø–æ–≤ ‚Üí +150% latency –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞**.
    
- **Afterburner –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å GraalVM Native Image –±–µ–∑ —Ä—É—á–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**.
    
- **Streaming API —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π JSON (–æ—à–∏–±–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ ‚Üí silent data corruption).**
    

---

# **58.1.22. Framework Integration Strategies**

### **58.1.22.1 Spring Boot**

Spring Boot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç ObjectMapper –∫–∞–∫ Singleton Bean (`MappingJackson2HttpMessageConverter`). –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —á–µ—Ä–µ–∑ `@Bean`.

```java
@Configuration
public class JacksonConfig {
  @Bean
  public ObjectMapper objectMapper() {
    return JsonMapper.builder()
      .addModule(new JavaTimeModule())
      .disable(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS)
      .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES)
      .build();
  }
}
```

üëâ –í—Å–µ `@RestController` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–æ—Ç –±–∏–Ω.

---

### **58.1.22.2 Micronaut / GraalVM Native**

Micronaut –∏—Å–ø–æ–ª—å–∑—É–µ—Ç compile-time introspection ‚Üí –±—ã—Å—Ç—Ä–µ–µ, –º–µ–Ω—å—à–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.

```java
@Introspected
public record User(String id, Instant createdAt) {}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** Jackson –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á—ë–Ω –∫–∞–∫ `jackson-databind` + `micronaut-jackson-databind`.

---

### **58.1.22.3 Quarkus**

Quarkus –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `JacksonRecorder` –¥–ª—è AOT. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è JSONB –∏ Jackson. –î–ª—è Jackson:

```properties
quarkus.jackson.write-dates-as-timestamps=false
quarkus.jackson.fail-on-unknown-properties=false
```

---

### ‚úî **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

1. Spring Boot global ObjectMapper.
    
2. Micronaut record + Jackson.
    
3. Quarkus application.properties –Ω–∞—Å—Ç—Ä–æ–π–∫–∞.
    

### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `new ObjectMapper()` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Spring Boot.
    
- –ù–µ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥—É–ª—å –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –ø—Ä–∏ JPMS ‚Üí `InvalidDefinitionException`.
    

---

# **58.1.23. GraalVM and Ahead-Of-Time (AOT) Considerations**

### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Jackson –≤ native-image:**

- –†–µ—Ñ–ª–µ–∫—Å–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    
- –ù—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
    

```json
[
  {
    "name": "com.example.model.User",
    "allDeclaredConstructors": true,
    "allDeclaredFields": true
  }
]
```

### **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –¥–≤–∏–∂–æ–∫: Micronaut Serde –∏–ª–∏ Jackson Native (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).**

---

### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä**

```bash
native-image \
  --initialize-at-build-time \
  -H:ReflectionConfigurationFiles=reflect-config.json
```

### ‚úñ –û—à–∏–±–æ—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä**

```java
record User(String id, Instant createdAt) {} // –ë–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚Üí runtime error
```

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- Afterburner –Ω–µ–ø—Ä–∏–≥–æ–¥–µ–Ω –¥–ª—è native-image.
    
- ObjectMapper auto-discovery –º–æ–¥—É–ª–µ–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ `--initialize-at-run-time`.
    

---

# **58.1.24. Best Practices Summary (—Ç–∞–±–ª–∏—á–Ω–æ–µ —Ä–µ–∑—é–º–µ)**

|–°—Ü–µ–Ω–∞—Ä–∏–π|–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è|–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è|
|---|---|---|
|–û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –ø–æ—Ç–æ–∫–æ–≤|Streaming API / SequenceWriter|`writeValueAsString(hugeList)`|
|–†–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏|`JavaTimeModule`, ISO-8601|Epoch timestamps –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é|
|–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å|Singleton ObjectMapper + Afterburner|–°–æ–∑–¥–∞–≤–∞—Ç—å ObjectMapper –≤–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–∞|
|–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å|–Ø–≤–Ω—ã–µ `@JsonTypeInfo` + –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è|`activateDefaultTyping` –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö|
|–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–¥—É–ª–µ–π|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BOM|–ú–∏–∫—Å–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –≤—Ä—É—á–Ω—É—é|
|–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è|ObjectMapper –∫–∞–∫ bean|`new ObjectMapper()` –ª–æ–∫–∞–ª—å–Ω–æ|

---

# 58.1.25. Formal References and Terminology Index

|–¢–µ—Ä–º–∏–Ω|–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ|–ù–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫|
|---|---|---|
|_Functional interface_|–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –º–µ—Ç–æ–¥–æ–º|JLS ¬ß9.8|
|_Target typing_|–í—ã–≤–æ–¥ —Ç–∏–ø–∞ –ª—è–º–±–¥—ã –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞|JLS ¬ß15.12|
|_JSON serialization_|–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –≤ JSON|Jackson Docs: `SerializationFeature`|
|_JSON deserialization_|–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ JSON –≤ –æ–±—ä–µ–∫—Ç|JLS ¬ß4, ¬ß5 (type conversions)|
|_ObjectMapper_|–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è data binding|Jackson Databind Spec|
|_Jackson Module_|–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ObjectMapper –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–∏–ø–æ–≤|Jackson Module System|
|_Default Typing_|–ì–µ–Ω–µ—Ä–∞—Ü–∏—è @class –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤|Jackson Security Notes|
|_AOT Reflection Config_|–û–ø–∏—Å–∞–Ω–∏–µ –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è GraalVM|GraalVM Native Image Guide|

–æ—Ç–ª–∏—á–Ω–æ ‚Äî –¥–æ–±–∞–≤–ª—è—é –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ **58.1.26‚Äì58.1.35** –≤ —Ç–æ–º –∂–µ —Å—Ç–∏–ª–µ. –Ø –Ω–∏—á–µ–≥–æ –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø—É–Ω–∫—Ç–∞—Ö –Ω–µ –º–µ–Ω—è—é.

---

## 58.1.26. –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã/–¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã –∏ `SimpleModule`

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã (`JsonSerializer<T>`) –∏ –¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã (`JsonDeserializer<T>`) ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–∞ data binding, –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –∑–∞–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ Java-—Ç–∏–ø–∞. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `Module` (–æ–±—ã—á–Ω–æ `SimpleModule`) –≤ `ObjectMapper`. –ü–æ–≤–µ–¥–µ–Ω–∏–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫—ç—à–µ–º —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤.

### 58.1.26.1. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

- –°–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä/–¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–ª–∞–Ω–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∏–ø–∞ –∏ **–∫–µ—à–∏—Ä—É–µ—Ç—Å—è**.
    
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑:
    
    ```java
    SimpleModule m = new SimpleModule()
        .addSerializer(Money.class, new MoneySer())
        .addDeserializer(Money.class, new MoneyDeser());
    mapper.registerModule(m);
    ```
    

### 58.1.26.2. –ü—Ä–∏–º–µ—Ä: —Ç–∏–ø `Money(amount: BigDecimal, currency: String)`

**–°–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä: –æ–±—ä–µ–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞**

```java
public record Money(BigDecimal amount, String currency) {}

public final class MoneySer extends JsonSerializer<Money> {
  @Override public void serialize(Money v, JsonGenerator g, SerializerProvider p) throws IOException {
    g.writeStartObject();
    g.writeStringField("amount", v.amount().toPlainString()); // –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
    g.writeStringField("currency", v.currency());
    g.writeEndObject();
  }
}
```

**–î–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä: ¬´—á–∏—Å–ª–æ –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞¬ª ‚Üí BigDecimal**

```java
public final class MoneyDeser extends JsonDeserializer<Money> {
  @Override public Money deserialize(JsonParser p, DeserializationContext ctx) throws IOException {
    JsonNode n = p.readValueAsTree();
    String amount = n.get("amount").isNumber() ? n.get("amount").asText()
                                               : n.get("amount").textValue();
    return new Money(new BigDecimal(amount), n.get("currency").asText());
  }
}
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `SimpleModule` + `JavaTimeModule` —Å–æ–≤–º–µ—Å—Ç–Ω–æ**
    

```java
ObjectMapper mapper = JsonMapper.builder()
    .addModule(new JavaTimeModule())
    .addModule(new SimpleModule().addSerializer(Money.class, new MoneySer()))
    .build();
```

2. **–ö–∞—Å—Ç–æ–º–Ω—ã–π key-serializer –¥–ª—è `Map<Instant, T>`**
    

```java
SimpleModule mod = new SimpleModule();
mod.addKeySerializer(Instant.class, new JsonSerializer<Instant>() {
  @Override public void serialize(Instant v, JsonGenerator g, SerializerProvider sp) throws IOException {
    g.writeFieldName(v.toString()); // ISO-8601 –∫–ª—é—á
  }
});
```

3. **–ö–∞—Å—Ç–æ–º–Ω—ã–π –¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä, —É—á–∏—Ç—ã–≤–∞—é—â–∏–π –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏**
    

```java
mod.addDeserializer(UUID.class, new JsonDeserializer<UUID>() {
  @Override public UUID deserialize(JsonParser p, DeserializationContext c) throws IOException {
    String s = p.getValueAsString();
    return (s == null || s.isBlank()) ? null : UUID.fromString(s);
  }
});
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –î–≤–æ–π–Ω–æ–π `writeStartObject()` –≤ —Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä–µ** ‚Äî —Å–ª–æ–º–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É JSON.
    
- **E2. –î–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä, —á–∏—Ç–∞—é—â–∏–π –Ω–∞–ø—Ä—è–º—É—é –∏–∑ `p.getText()` –≤ —Å–ª—É—á–∞–µ –æ–±—ä–µ–∫—Ç–∞** ‚Äî –ø–æ—Ç–µ—Ä—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `readValueAsTree()` –∏–ª–∏ –ø–æ —Ç–æ–∫–µ–Ω–∞–º.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –°–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã/–¥–µ—Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã **–∫–µ—à–∏—Ä—É—é—Ç—Å—è** ‚Äî –∏–∑–º–µ–Ω—è—Ç—å –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–ª—å–∑—è.
    
- –£—á–∏—Ç—ã–≤–∞–π—Ç–µ null-–ø–æ–ª–∏—Ç–∏–∫—É (`isEmpty`, `@JsonInclude`) ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å–µ—Ä–∏–∞–ª–∞–π–∑–µ—Ä—ã –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ –≤–∫–ª—é—á–µ–Ω–∏–µ/–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª–µ–π.
    

---

## 58.1.27. Coercion/Leniency Matrix (—Å—Ç—Ä–æ–≥–æ—Å—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _Coercion_ ‚Äî –ø–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ö–æ–¥–Ω—ã—Ö JSON-–∑–Ω–∞—á–µ–Ω–∏–π –∫ —Ç—Ä–µ–±—É–µ–º–æ–º—É Java-—Ç–∏–ø—É (—Å—Ç—Ä–æ–∫–∞‚Üí—á–∏—Å–ª–æ, –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞‚Üínull –∏ —Ç.–¥.). –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `CoercionConfig`, `DeserializationFeature` –∏ `JsonReadFeature`.

### 58.1.27.1. –ß–∞—Å—Ç—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏

|–ò—Å—Ç–æ—á–Ω–∏–∫ ‚Üí –¶–µ–ª—å|–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (—á–∞—Å—Ç–æ)|–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤|
|---|---|---|
|`string` ‚Üí `int/long`|–¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ä—è–¥–µ –≤–µ—Ä—Å–∏–π|**Fail:** `CoercionAction.Fail`|
|`""` (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞) ‚Üí –æ–±—ä–µ–∫—Ç|–∏–Ω–æ–≥–¥–∞ –∫–∞–∫ `null`|**Fail** –∏–ª–∏ **AsNull** –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ|
|–æ–¥–∏–Ω–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‚Üí –º–∞—Å—Å–∏–≤|`ACCEPT_SINGLE_VALUE_AS_ARRAY` –≤—ã–∫–ª—é—á–µ–Ω|–≤–∫–ª—é—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–Ω–æ|
|`float` ‚Üí `int`|–¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è|–≤—ã–∫–ª—é—á–∏—Ç—å `ACCEPT_FLOAT_AS_INT`|

**API-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

```java
mapper.enable(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY);
mapper.disable(DeserializationFeature.ACCEPT_FLOAT_AS_INT);

mapper.coercionConfigFor(LogicalType.Integer)
      .setCoercion(CoercionInputShape.Float, CoercionAction.Fail);

mapper.coercionConfigFor(LogicalType.POJO)
      .setCoercion(CoercionInputShape.EmptyString, CoercionAction.AsNull);
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ó–∞–ø—Ä–µ—Ç float‚Üíint**
    

```java
mapper.disable(DeserializationFeature.ACCEPT_FLOAT_AS_INT);
```

2. **–†–∞–∑—Ä–µ—à–∏—Ç—å –æ–¥–∏–Ω–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∫ –º–∞—Å—Å–∏–≤ —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ**
    

```java
ObjectReader r = mapper.readerFor(new TypeReference<List<String>>() {})
                       .with(DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY);
```

3. **–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –∫–∞–∫ null –¥–ª—è value-–æ–±—ä–µ–∫—Ç–æ–≤**
    

```java
mapper.coercionConfigFor(LogicalType.POJO)
      .setCoercion(CoercionInputShape.EmptyString, CoercionAction.AsNull);
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ì–ª–æ–±–∞–ª—å–Ω–æ –≤–∫–ª—é—á–∏—Ç—å `ACCEPT_SINGLE_VALUE_AS_ARRAY`** ‚Üí –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã –≤–µ–∑–¥–µ.
    
- **E2. –û—Å—Ç–∞–≤–∏—Ç—å `ACCEPT_FLOAT_AS_INT` –≤–∫–ª—é—á—ë–Ω–Ω—ã–º –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö/–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ª–µ–π** ‚Üí –ø–æ—Ç–µ—Ä—è —Ç–æ—á–Ω–æ—Å—Ç–∏/—Å–º—ã—Å–ª–æ–≤–∞—è –æ—à–∏–±–∫–∞.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–µ—Ä—Å–∏–∏ Jackson ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏—Ö —è–≤–Ω–æ –Ω–∞ –º–∞–ø–ø–µ—Ä–µ/—Ä–∏–¥–µ—Ä–µ.
    
- –†–∞–∑–Ω—ã–µ —Ä–∏–¥–µ—Ä—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å **—Ä–∞–∑–Ω—ã–µ** –ø–æ–ª–∏—Ç–∏–∫–∏; –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ –≤ –∫–æ–¥–µ.
    

---

## 58.1.28. Enum-handling: –∏–º—è, `@JsonValue`, `@JsonCreator`, fallback

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** –î–ª—è `enum` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–¥—ë—Ç –ø–æ `name()`. –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî `@JsonValue` (–Ω–∞ –∑–∞–ø–∏—Å—å) –∏ `@JsonCreator` (–Ω–∞ —á—Ç–µ–Ω–∏–µ).

### –ü—Ä–∞–∫—Ç–∏–∫–∏

- –î–ª—è —ç–≤–æ–ª—é—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **case-insensitive** –º–∞–ø–ø–∏–Ω–≥ –∏ fallback.
    
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–π—Ç–µ `name()` —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π.
    

**–ü—Ä–∏–º–µ—Ä—ã**

```java
enum Status {
  OK, FAIL, OTHER;

  @JsonCreator
  public static Status from(String s) {
    return Arrays.stream(values())
        .filter(v -> v.name().equalsIgnoreCase(s))
        .findFirst().orElse(OTHER);
  }
}
```

```java
enum Role {
  USER("user"), ADMIN("admin");
  private final String wire;
  Role(String wire) { this.wire = wire; }
  @JsonValue public String wire() { return wire; }
}
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **Case-insensitive —á—Ç–µ–Ω–∏–µ**
    

```java
mapper.enable(MapperFeature.ACCEPT_CASE_INSENSITIVE_ENUMS);
```

2. **`@JsonValue` –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫**
    

```java
// —Å–º. Role –≤—ã—à–µ
```

3. **Fallback-–ø–æ–ª–µ OTHER —á–µ—Ä–µ–∑ `@JsonCreator`** ‚Äî —Å–º. `Status.from(...)`.
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ enum** –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Üí –ø–æ–ª–æ–º–∫–∞ —á—Ç–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    
- **E2. `@JsonValue` –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–∂–∏–¥–∞–Ω–∏–µ —á—Ç–µ–Ω–∏—è –ø–æ name()** ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–∑–Ω—ã–º –Ω–∞ —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- `@JsonValue` –º–µ–Ω—è–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é**; –¥–ª—è —á—Ç–µ–Ω–∏—è –Ω—É–∂–µ–Ω `@JsonCreator`.
    
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è enum –∫–∞–∫ **—á–∞—Å—Ç—å –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞**.
    

---

## 58.1.29. –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥: –ø–æ—Ä—è–¥–æ–∫ –ø–æ–ª–µ–π, —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞–ø—à–æ—Ç–æ–≤

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–π/HashMap.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏

```java
mapper.configure(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY, true);
```

```java
@JsonPropertyOrder({"id", "createdAt", "name"})
class User { /* ... */ }
```

**Map-–ø–æ–ª—è:** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `LinkedHashMap`/`TreeMap` –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∫–ª—é—á–µ–π.

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ê–ª—Ñ–∞–≤–∏—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–≤–æ–π—Å—Ç–≤**
    

```java
mapper.enable(MapperFeature.SORT_PROPERTIES_ALPHABETICALLY);
```

2. **–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –Ω–∞ —Ç–∏–ø–µ** ‚Äî `@JsonPropertyOrder`.
    
3. **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –∫–∞—Ä—Ç**
    

```java
Map<String,Object> m = new TreeMap<>(); // –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—è–¥–æ–∫
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –û–∂–∏–¥–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —É `HashMap`** ‚Äî –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è.
    
- **E2. –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å JSON-—Å—Ç—Ä–æ–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö –±–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏/–ø—Ä–æ–µ–∫—Ü–∏–∏** ‚Äî flaky.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–≤–æ–π—Å—Ç–≤ ‚Üí –Ω–µ–±–æ–ª—å—à–æ–π –æ–≤–µ—Ä—Ö–µ–¥; –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ –∞–¥—Ä–µ—Å–Ω–æ (writer —Å —Ñ–∏—á–æ–π).
    
- –î–ª—è —Å–∏–≥–Ω–∞—Ç—É—Ä/—Ö–µ—à–µ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ **–∏** —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —á–∏—Å–µ–ª/–¥–∞—Ç.
    

---

## 58.1.30. Dataformats: Smile, CBOR, Ion, YAML, CSV

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** Jackson –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `*Factory` –∏ –º–∞–ø–ø–µ—Ä—ã:

|–§–æ—Ä–º–∞—Ç|–ê—Ä—Ç–µ—Ñ–∞–∫—Ç|–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å|
|---|---|---|
|Smile (binary JSON)|`jackson-dataformat-smile`|–ú–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–µ –¥–≤–æ–∏—á–Ω–æ–µ, –∫–æ–º–ø–∞–∫—Ç–Ω–æ/–±—ã—Å—Ç—Ä–æ|
|CBOR|`jackson-dataformat-cbor`|IoT/–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω—ã–π JSON|
|Amazon Ion|`jackson-dataformat-ion`|–ë–æ–≥–∞—Ç—ã–π –¥–≤–æ–∏—á–Ω—ã–π/—Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç AWS|
|YAML|`jackson-dataformat-yaml`|–ù–∞—Å—Ç—Ä–æ–π–∫–∏/—á–µ–ª–æ–≤–µ—á–µ—Å–∫–æ–µ —á—Ç–µ–Ω–∏–µ|
|CSV|`jackson-dataformat-csv`|–¢–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/—ç–∫—Å–ø–æ—Ä—Ç|

**–ü—Ä–∏–º–µ—Ä:**

```java
ObjectMapper smile = new ObjectMapper(new SmileFactory());
byte[] data = smile.writeValueAsBytes(dto);
MyDto back = smile.readValue(data, MyDto.class);
```

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **CBOR –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏**
    

```java
ObjectMapper cbor = new ObjectMapper(new CBORFactory());
```

2. **YAML –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤**
    

```java
ObjectMapper yaml = new ObjectMapper(new YAMLFactory());
```

3. **CSV –¥–ª—è –ø–ª–æ—Å–∫–∏—Ö DTO**
    

```java
CsvMapper csv = new CsvMapper();
CsvSchema schema = csv.schemaFor(MyDto.class).withHeader();
String out = csv.writer(schema).writeValueAsString(dtoList);
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YAML –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏** ‚Äî –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç—å/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.
    
- **E2. –ü–æ–ª–∞–≥–∞—Ç—å, —á—Ç–æ Smile/CBOR —á–∏—Ç–∞—é—Ç—Å—è –ª—é–±—ã–º JSON-–ø–∞—Ä—Å–µ—Ä–æ–º** ‚Äî –Ω—É–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–±—Ä–∏–∫–∏.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã ‚Üí —Ä–∞–∑–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è; –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π.
    
- –í CSV –Ω–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä ‚Äî —Ç—Ä–µ–±—É—é—Ç—Å—è –∞–¥–∞–ø—Ç–µ—Ä—ã.
    

---

## 58.1.31. Kotlin/Scala-–º–æ–¥—É–ª–∏ –∏ nullable-—Ç–∏–ø—ã

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** –î–ª—è Kotlin/Scala —Ç—Ä–µ–±—É—é—Ç—Å—è –º–æ–¥—É–ª–∏ Jackson, —á—Ç–æ–±—ã —É—á–∏—Ç—ã–≤–∞—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–∏–ø–æ–≤ (nullable, default values, case classes).

### Kotlin

```kotlin
val mapper = jacksonObjectMapper()
  .registerModule(KotlinModule.Builder().build())
```

- –£—á–∏—Ç—ã–≤–∞–µ—Ç `val`/`var`, `data class`, default-–∑–Ω–∞—á–µ–Ω–∏—è, `nullability` (—á–µ—Ä–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤).
    

### Scala

```scala
val mapper = new ObjectMapper() with ScalaObjectMapper
mapper.registerModule(DefaultScalaModule)
```

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `Option`, –∫–æ–ª–ª–µ–∫—Ü–∏–π Scala, case classes.
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **Kotlin data class —Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏**
    

```kotlin
data class User(val id: String, val active: Boolean = true)
```

2. **Kotlin: `Instant` —Å JavaTimeModule**
    

```kotlin
mapper.registerModule(JavaTimeModule())
```

3. **Scala: Option**
    

```scala
case class User(id: String, active: Option[Boolean])
```

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ù–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å `jackson-module-kotlin`** ‚Üí NPE/–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞.
    
- **E2. –ü–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ JavaBean-–∫–æ–Ω–≤–µ–Ω—Ü–∏–∏ –≤ data class –±–µ–∑ –º–æ–¥—É–ª—è**.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –î–ª—è Kotlin —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—Å–∫–∞—è –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö ‚Äî –º–æ–¥—É–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω.
    
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π –º–æ–¥—É–ª–µ–π —Å `databind`.
    

---

## 58.1.32. –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Observability)

**–¶–µ–ª—å.** –°–¥–µ–ª–∞—Ç—å –ø—Ä–∏—á–∏–Ω—ã —Å–±–æ–µ–≤ –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –∏ –∏–∑–º–µ—Ä—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

- –õ–æ–≥–∏—Ä—É–π—Ç–µ **–ø—É—Ç—å** –∏ **–ø–æ–∑–∏—Ü–∏—é**:
    

```java
catch (JsonMappingException e) {
  log.warn("Mapping error at {} @ {}: {}", e.getPathReference(), e.getLocation(), e.getOriginalMessage());
}
```

- –°—á—ë—Ç—á–∏–∫–∏: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `JsonParseException`, `UnrecognizedPropertyException`, –≤—Ä–µ–º—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/—Ä–∞–∑–º–µ—Ä payload.
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–ú–µ—Ç—Ä–∏–∫–∏ –≤–æ–∫—Ä—É–≥ –º–∞–ø–ø–µ—Ä–∞**
    

```java
long t0 = System.nanoTime();
byte[] body = mapper.writeValueAsBytes(dto);
metrics.timer("json.serialize").record(System.nanoTime() - t0, NANOSECONDS);
metrics.counter("json.bytes").increment(body.length);
```

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π**
    

```java
catch (UnrecognizedPropertyException e) {
  log.info("Unknown property {} at {}", e.getPropertyName(), e.getPathReference());
}
```

3. **–¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∫—Ä—É–ø–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤**
    

```java
mapper.factory().setCodec(mapper);
```

(–∏ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –ø–æ –¥–ª–∏–Ω–µ)

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ì–ª–æ—Ç–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è Jackson** ‚Üí –ø–æ—Ä—á–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ —Å–∏–≥–Ω–∞–ª–∞.
    
- **E2. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å JSON –ø—Ä–∏ –æ—à–∏–±–∫–µ** –Ω–∞ –ø—Ä–æ–¥–µ ‚Üí —É—Ç–µ—á–∫–∏ PII/–±–æ–ª—å—à–∏–µ –ª–æ–≥–∏.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –°–æ–±–ª—é–¥–∞–π—Ç–µ –ø–æ–ª–∏—Ç–∏–∫—É PII/—Å–µ–∫—Ä–µ—Ç–æ–≤ ‚Äî –ª–æ–≥–∏—Ä—É–π—Ç–µ **–∫–æ–Ω—Ç–µ–∫—Å—Ç**, –∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.
    
- –î–ª—è —Ç—Ä–∞—Å—Å –∫—Ä—É–ø–Ω–æ–≥–æ JSON —Ö—Ä–∞–Ω–∏—Ç–µ **—Ö—ç—à**/—Ä–∞–∑–º–µ—Ä/–∏–¥empotency-key.
    

---

## 58.1.33. –≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (Compatibility Patterns)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.** _–≠–≤–æ–ª—é—Ü–∏—è —Å—Ö–µ–º—ã_ ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è JSON-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –±–µ–∑ —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏.

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã

- **Backward-compatible**: –¥–æ–±–∞–≤–ª—è–π—Ç–µ **–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ** –ø–æ–ª—è; —á–∏—Ç–∞—Ç–µ–ª—å —Å `FAIL_ON_UNKNOWN_PROPERTIES=false` –Ω–µ —É–ø–∞–¥—ë—Ç.
    
- **Enum-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è**: –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è; –Ω–∞ —á—Ç–µ–Ω–∏–∏ ‚Äî `OTHER`-fallback (—Å–º. 58.1.28).
    
- **–î–µ–ø—Ä–µ–∫–∞—Ü–∏—è –ø–æ–ª–µ–π**: –≤—Ä–µ–º–µ–Ω–Ω–æ –¥—É–±–ª–∏—Ä—É–π—Ç–µ —Å –Ω–æ–≤—ã–º–∏ –∏–º–µ–Ω–∞–º–∏; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `@JsonAlias` –Ω–∞ —á—Ç–µ–Ω–∏–µ, `@JsonProperty` –Ω–∞ –∑–∞–ø–∏—Å—å.
    

```java
class User {
  @JsonProperty("id") String id;
  @JsonAlias({"is_active","enabled"}) boolean active;
}
```

- **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ø–æ–ª–µ `schemaVersion` –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Contract-Version`; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ `oneOf` –≤ JSON Schema.
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **Alias –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏**
    

```java
@JsonAlias({"oldName"}) String newName;
```

2. **–ò–≥–Ω–æ—Ä –ª–∏—à–Ω–∏—Ö –ø–æ–ª–µ–π**
    

```java
mapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);
```

3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ enum** (—Å–º. 58.1.28).
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è –±–µ–∑ alias –∏ –ø–µ—Ä–∏–æ–¥–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏**.
    
- **E2. –ñ—ë—Å—Ç–∫–∏–π —Ä–µ–∂–∏–º `FAIL_ON_UNKNOWN_PROPERTIES=true` –Ω–∞ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö** ‚Äî –ª–æ–º–∞–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –î–µ—Ä–∂–∏—Ç–µ –º–∞—Ç—Ä–∏—Ü—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ ¬´–∫–ª–∏–µ–Ω—Ç‚Üî—Å–µ—Ä–≤–µ—Ä¬ª –≤ —Ä–µ–ª–∏–∑-–Ω–æ—Ç–∞—Ö.
    
- –°—Ö–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å _–º–µ–¥–ª–µ–Ω–Ω–µ–µ_ –∫–æ–¥–∞ ‚Äî –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç.
    

---

## 58.1.34. JPMS: –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã `opens` (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏)

**–ü—Ä–æ–±–ª–µ–º–∞.** –ì–ª–æ–±–∞–ª—å–Ω–æ–µ `opens` —Ä–∞—Å—à–∏—Ä—è–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏. –¶–µ–ª—å ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å.

### –ü–æ–¥—Ö–æ–¥—ã

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø—É–±–ª–∏—á–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã/—Ñ–∞–±—Ä–∏–∫–∏** (`@JsonCreator`) –≤–º–µ—Å—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.
    
- –î–µ–ª–∞—Ç—å `opens` —Ç–æ—á–µ—á–Ω—ã–º:
    

```java
opens com.example.model to com.fasterxml.jackson.databind; // —Ç–æ–ª—å–∫–æ –º–æ–¥—É–ª—é Jackson
```

- –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ **–≤–∏–¥–∏–º—ã–µ –ø–æ–ª—è** –±–µ–∑ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ –ø–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–º:  
    `mapper.setVisibility(PropertyAccessor.FIELD, Visibility.PUBLIC_ONLY);`
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **–¢–æ—á–µ—á–Ω—ã–π `opens`** ‚Äî —Å–º. –≤—ã—à–µ.
    
2. **`@JsonCreator` –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–π —Ñ–∞–±—Ä–∏–∫–µ**
    

```java
public final class User {
  public final String id;
  private User(String id) { this.id = id; }
  @JsonCreator public static User of(@JsonProperty("id") String id) { return new User(id); }
}
```

3. **–û—Ç–∫–∞–∑ –æ—Ç FIELD-ANY –≤ –ø–æ–ª—å–∑—É –≥–µ—Ç—Ç–µ—Ä–æ–≤** ‚Äî –º–µ–Ω—å—à–µ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.
    

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. `opens ...;` –Ω–∞ –≤–µ—Å—å –º–æ–¥—É–ª—å** –±–µ–∑ –Ω—É–∂–¥—ã ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏.
    
- **E2. –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –±–µ–∑ `@JsonCreator` –≤ —Å—Ç—Ä–æ–≥–æ–º JPMS** ‚Äî `InvalidDefinitionException`.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ _SecurityManager/Policy_ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) –∏ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏.
    

---

## 58.1.35. –ü–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –∫—ç—à, –±—É—Ñ–µ—Ä—ã, –ø–ª–∞–Ω —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 58.1.35.1. –ë—É—Ñ–µ—Ä—ã –∏ `BufferRecycler`

Jackson –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –±–∞–π—Ç–æ–≤—ã–µ/—Å–∏–º–≤–æ–ª—å–Ω—ã–µ –±—É—Ñ–µ—Ä—ã. –î–ª–∏—Ç–µ–ª—å–Ω–æ –∂–∏–≤—É—â–∏–π `ObjectMapper` –∏ —Ñ–∞–±—Ä–∏–∫–∏ (`JsonFactory`) —É–º–µ–Ω—å—à–∞—é—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –∏ –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ GC.

```java
JsonFactory factory = JsonFactory.builder()
    // –ø—Ä–∏–º–µ—Ä: –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—é –∏–º–µ–Ω, –µ—Å–ª–∏ —É –≤–∞—Å –æ—á–µ–Ω—å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è
    .configure(StreamReadFeature.CANONICALIZE_FIELD_NAMES.mappedFeature(), true)
    .build();
```

### 58.1.35.2. Writer/SequenceWriter vs writeValue

|–°—Ü–µ–Ω–∞—Ä–∏–π|–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è|
|---|---|
|–ü–æ—Ç–æ–∫–æ–º –ø–∏—Å–∞—Ç—å 10^5‚Äì10^7 –æ–±—ä–µ–∫—Ç–æ–≤|`ObjectWriter.writeValues(OutputStream)`|
|–ù–µ–±–æ–ª—å—à–æ–π DTO|`writeValueAsBytes/To(OutputStream)`|
|–ë–æ–ª—å—à–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –≤ –ø–∞–º—è—Ç—å|–∏–∑–±–µ–≥–∞—Ç—å; –ª–∏–±–æ —á–∞–Ω–∫–æ–≤–∞—Ç—å, –ª–∏–±–æ `SequenceWriter`|

### 58.1.35.3. –≠—Å–∫–µ–π–ø–∏–Ω–≥ –∏ –≤—ã–±–æ—Ä —Ñ–æ—Ä–º–∞—Ç–∞

- JSON —Ç—Ä–µ–±—É–µ—Ç —ç—Å–∫–µ–π–ø–∏–Ω–≥–∞ —Å—Ç—Ä–æ–∫ ‚Üí CPU overhead; –¥–ª—è –¥–≤–æ–∏—á–Ω—ã—Ö/—á–∏—Å–ª–æ–≤—ã—Ö –¥–æ–º–µ–Ω–æ–≤ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ **Smile/CBOR** (—Å–º. 58.1.30).
    

#### ‚úî –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (3)

1. **SequenceWriter –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–≥—Ä—É–∑–æ–∫**
    

```java
try (SequenceWriter seq = mapper.writer().writeValues(out)) {
  stream().forEach(obj -> { try { seq.write(obj); } catch (IOException e) { /* ... */ } });
}
```

2. **–ü—Ä–µ–¥—Å–æ–∑–¥–∞–Ω–Ω—ã–µ `ObjectWriter` –ø–æ–¥ —Ç–∏–ø—ã**
    

````java
static final ObjectWriter USER_WRITER = mapper.writerFor(User.class);
``]
3) **–ß–∞–Ω–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –º–∞—Å—Å–∏–≤–∞**
```java
gen.writeStartArray();
for (List<User> chunk : chunks(users, 10_000)) {
  for (User u : chunk) { mapper.writeValue(gen, u); }
}
gen.writeEndArray();
````

#### ‚úñ –û—à–∏–±–æ—á–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã (2)

- **E1. `writeValueAsString(hugeList)`** ‚Üí –ø–∏–∫ –ø–∞–º—è—Ç–∏ –∏ GC stop-the-world.
    
- **E2. –°–æ–∑–¥–∞–≤–∞—Ç—å `ObjectWriter` –≤–Ω—É—Ç—Ä–∏ tight loop** ‚Äî –ø–æ—Ç–µ—Ä—è –∫–µ—à–∞.
    

**–ü–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**

- SequenceWriter —Å–∞–º –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø—è—Ç—ã–µ –≤–Ω–µ –º–∞—Å—Å–∏–≤–∞ ‚Äî –æ–±—Ä–∞–º–ª—è–π—Ç–µ `writeStartArray()/writeEndArray()`, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–º–µ–Ω–Ω–æ JSON-–º–∞—Å—Å–∏–≤.
    
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ: JFR/async-profiler –ø–æ–∫–∞–∂–µ—Ç –≥–æ—Ä—è—á–∏–µ –º–µ—Å—Ç–∞ –∞–ª–ª–æ–∫–∞—Ü–∏–π –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.
    

---

